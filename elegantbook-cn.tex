\documentclass[lang=cn,newtx,10pt,scheme=chinese]{elegantbook}

\title{机器学习讲义}
\subtitle{2023级用}

\author{王予沛 \& \texttt{ChatGPT} \& \texttt{Claude}}
\institute{北京师范大学数字人文系}
% \date{2022/12/31}
% \version{4.5}
% \bioinfo{自定义}{信息}

\extrainfo{本讲义扩展自
\href{https://github.com/afshinea/stanford-cs-229-machine-learning}{斯坦福大学CS229小抄}\\
封面图片由\href{https://www.midjourney.com/home/}{Midjourney}创作
}

\setcounter{tocdepth}{3}

\logo{logo-blue.png}
\cover{cover_0913.png}

% 本文档命令
\usepackage{array}
\usepackage{arydshln}
\newcommand{\ccr}[1]{\makecell{{\color{#1}\rule{1cm}{1cm}}}}

% 修改标题页的橙色带
\definecolor{customcolor}{RGB}{32,178,170}
\colorlet{coverlinecolor}{customcolor}
\usepackage{cprotect}

\usepackage{blindtext}
\usepackage{hyperref}

\definecolor{mygray}{gray}{0.9}
\definecolor{headergray}{gray}{0.7}

\addbibresource[location=local]{reference.bib} % 参考文献，不要删除

\begin{document}

\maketitle
\frontmatter

\tableofcontents

\mainmatter

\chapter{矩阵与变换}

\begin{introduction}
  \item 从方程组到矩阵
  \item 从线性变换到矩阵
  \item 矩阵的运算
  \item 矩阵的性质
\end{introduction}

参考资料：
\begin{enumerate}
    \item \href{https://github.com/afshinea/stanford-cs-229-machine-learning/blob/master/zh/refresher-algebra-calculus.pdf}{Machine Learning cheatsheets for Stanford's CS 229 - VIP Refresher: Linear Algebra and Calculus};
    \item \href{https://math.mit.edu/~gs/linearalgebra/ila5/indexila5.html}{Introduction to Linear Algebra, Fifth Edition (2016)};
    \item 高中数学人教A版选修4-2:矩阵与变换.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{从方程组到矩阵}
\label{sec:origin_of_matrix}

\begin{note}
本节旨在帮助学生了解矩阵产生的原因，它源于人们在解方程组时对简洁表达的需求。
\end{note}

\subsection{二元一次方程组}
\label{subsec:二元一次方程组}

让我们首先回顾一下二元一次方程组的基本概念。一个二元一次方程组由两个含有两个变量的一次方程组成。一般形式如下：

\begin{equation}
\left\{
\begin{array}{l}
ax_1 + bx_2 = c\\
dx_1 + ex_2 = f
\end{array}
\right.
\label{eq:二元一次方程组通式}
\end{equation}

其中，\(x_1\) 和 \(x_2\) 是我们要找的未知数，而 \(a\)、\(b\)、\(c\)、\(d\)、\(e\) 和 \(f\) 是已知的常数。

要解这样的方程组，我们通常会使用以下两种方法之一：
\begin{enumerate}
    \item \textbf{代数方法}：这种方法包括“代入法”和“消元法”。
    \begin{enumerate}
        \item 在代入法中，我们从一个方程中解出一个变量的表达式，然后将其代入另一个方程；
        \item 在消元法中，我们通过加减两个方程来消除一个变量，从而找到另一个变量的值。
    \end{enumerate}
    \item \textbf{图形方法}：在这种方法中，我们将每个方程视为二维空间中的一条直线。方程组的解就是这两条直线的交点。
\end{enumerate}


下面，我们使用\textbf{消元法}来解以下二元一次方程组：

\begin{equation}
\left\{
\begin{array}{l}
2x_1 + 3x_2 = 5\\
4x_1 + 5x_2 = 7
\end{array}
\right.
\label{eq:二元一次方程组示例}
\end{equation}

我们的目标是找到满足这两个方程的\(x_1\)和\(x_2\)的值。我们可以通过以下步骤来实现这一目标：

\begin{enumerate}
    \item 首先，我们可以使用第一个方程来消去第二个方程中的\(x_1\)。为此，我们可以将第一个方程的两边都乘以2，得到新的方程：
    \[
    4x_1 + 6x_2 = 10
    \]
    \item 接着，我们将新得到的方程从第二个方程中减去，从而消去\(x_1\)：
    \[
    4x_1 + 5x_2 - (4x_1 + 6x_2) = 7 - 10
    \]
    这将给我们一个只包含\(x_2\)的方程：
    \[
    -x_2 = -3
    \]
    从中我们可以找到\(x_2\)的值：
    \[
    x_2 = 3
    \]
    \item 事实上，\(x_2 = 3\)可以看成一个方程，我们可以使用它来消去第一个方程中的\(x_2\)：
    \[
    (2x_1 + 3x_2) + (-3) \cdot x_2 = 5 + (-3) \cdot 3
    \]
    这将给我们：
    \[
    2x_1 = 5 - 9
    \]
    从中我们可以找到\(x_1\)的值：
    \[
    2x_1 = -4
    \]
    \[
    x_1 = -2
    \]
\end{enumerate}

所以，该方程组的解是：
\[
x_1 = -2, \quad x_2 = 3
\]


在下一节中，我们将介绍如何使用高斯消元法和矩阵来更简洁地表达求解过程。

\vspace{0.5cm}

\begin{note}
    用方程$\alpha$减去方程$\beta$指：用方程$\alpha$的左边减去方程$\beta$的左边，用方程$\alpha$的右边减去方程$\beta$的右边。
\end{note}

\subsection{系数矩阵和增广矩阵}
\label{subsec:系数矩阵和增广矩阵}

考虑二元一次方程组\ref{eq:二元一次方程组示例}。我们将方程组中方程的所有系数按照它们在整理好的方程中的位置取出来写成如式\ref{eq:系数矩阵示例}的一张数表。有了这张数表我们就可以更加简洁地表达方程组中未知数的系数，因此我们将其称为方程组的\textcolor{third}{\bf 系数矩阵}，我们将其记为大写字母$A$。

\begin{equation}
  A = \left(\begin{array}{ll}
2 & 3 \\
4 & 5
\end{array}\right)
\label{eq:系数矩阵示例}
\end{equation}

如果我们在系数矩阵右边增加一列，用于记录方程的右端项（right hand side, RHS），并且用一根竖线隔开表示系数的数表和表示右端项的数列，得到的整个新数表称为方程组\ref{eq:二元一次方程组示例}的\textcolor{third}{\bf 增广矩阵}，如式\ref{eq:增广矩阵示例}所示：
\begin{equation}
    [A \mid B]=\left(\begin{array}{cc|c}
2 & 3 & 5 \\
4 & 5 & 7
\end{array}\right)
\label{eq:增广矩阵示例}
\end{equation}

下面，我们对增广矩阵实施第\ref{subsec:二元一次方程组}节中所使用的消元法，从而达到解方程的目的:

\begin{enumerate}
    \item 首先,我们用第一行的系数来将第二行的系数化为$0$,具体操作如下:
    \begin{enumerate}
        \item 用第二行的第一个系数$4$除以第一行的第一个系数$2$,得到商数$2$;
        \item 将第一行整体乘以此商数（$2$）,得到$(4,6,10)$;
        \item 再用第二行减去第一行,则第二行的第一个元素变为$0$。这时增广矩阵变为：
        \begin{equation}
            \left(\begin{array}{cc|c}
        2 & 3 & 5 \\
        0 & -1 & -3
        \end{array}\right)
        \label{eq:行阶梯形矩阵}
        \end{equation}
        \item 在第二行两边乘以$-1$
    \end{enumerate}
    \item 现在用第二行中$x_2$的系数来将第一行中$x_2$的系数化为$0$，具体操作如下：
    \begin{enumerate}
        \item 用第一行的第二个系数$3$除以第二行的第二个系数$1$，得到商数$3$;
        \item 将第二行整体乘以此商数（$3$）,得到$(0,3,9)$;
        \item 再用第一行减去第二行,则第一行的第二个元素变为$0$。这时增广矩阵变为：
        \[
        \left(\begin{array}{cc|c}
        2 & 0 & -4 \\
        0 & 1 & 3
        \end{array}\right)
        \]
        \item 在第一行两边乘以$\frac{1}{2}$，得到增广矩阵：
        \begin{equation}
            \left(\begin{array}{cc|c}
        1 & 0 & -2 \\
        0 & 1 & 3
        \end{array}\right)
        \label{eq:简化行阶梯形矩阵}
        \end{equation}
    \end{enumerate}
\end{enumerate}

该式还原为方程组为

\[
\left\{
\begin{array}{l}
1 \cdot x_1 + 0 \cdot x_2 = -2\\
0 \cdot x_1 + 1\cdot x_2 = 3
\end{array}
\right.
\]


最终得到$x_1=-2$，$x_2=3$，这就是原方程组的解。

矩阵提供了一种组织方程组系数和常数项的方式，通过矩阵运算可以方便地求解方程组。这启发了矩阵理论的产生和发展。


\subsection{高斯-若尔当消元法}
\label{subsec:高斯-若尔当消元法}

回顾我们在第\ref{subsec:系数矩阵和增广矩阵}节中的操作，我们在增广矩阵上进行消元法时，仅仅使用了两种操作：
\begin{itemize}
    \item 把某行乘以一非零常数；
    \item 把第 $i$ 行加上第 $j$ 行的 $k$ 倍；
\end{itemize}

可见这些操作都是对矩阵的“行”进行的，因此我们称它们为\textcolor{third}{\bf 行变换}。

注意到，在进行消元法的过程中，我们得到的增广矩阵\ref{eq:行阶梯形矩阵}的非零元素看起来像是一个“倒过来的楼梯”，其第一行左起第一个非零元下方都是零，第二行左起第一个非零元在第一行左起第一个非零元的右侧，我们称这样的矩阵是\textcolor{third}{\bf 行阶梯形矩阵}。

\begin{definition}[行阶梯形矩阵]
    如果一个矩阵满足下面的条件，我们称其为{\bf 行阶梯形矩阵}（Row Echelon Form）：
    \begin{enumerate}
        \item 所有仅包含零的行都位于矩阵的最底部；
        \item 在每一个非零行中，最左边的非零元素（称主元）总是出现在上一行主元的右侧；
        \item *包含非零元素的行中，首个非零元素必须为$1$.
    \end{enumerate}
    其中第三个条件是可选的，不同文献中有不同的定义方式，不必纠结。
\end{definition}

事实上，得到增广矩阵\ref{eq:行阶梯形矩阵}后，我们已经不再需要继续消元了。从第二行我们可以很容易的得到$-x_2=-3$，从而解出$x_2=3$。从第一行我们得到方程$2x_1+3x_2=5$，这时候我们使用\textbf{回代法}，将$x_2=3$代到方程$2x_1+3x_2=5$中得到$2x_1+3\cdot 3=5$，从而解出$x_1=-2$。

一般地，我们称\textcolor{second}{“先通过行变换将矩阵化为上三角形，然后直接通过回代法找到方程组的解”}这样的解方程的方法为\textcolor{third}{\bf 高斯消元法}。可以证明，任何矩阵都可以通过高斯消元法转换为简化行阶梯形形式

此外，当消元法进行到尾声时，我们得到的增广矩阵\ref{eq:简化行阶梯形矩阵}非常有特点，其每一行的第一个非零元素全是$1$，且这些行的第一个元素$1$所在列的其余元素全为零，我们称这样的矩阵是\textcolor{third}{\bf 简化行阶梯形矩阵}。显然，根据简化行阶梯形矩阵我们很容易得到方程组的解。

\begin{definition}[简化行阶梯形]
    如果一个矩阵满足下面的条件，我们称其为{\bf 简化行阶梯形}（Reduced Row Echelon Form, RREF）：
\begin{enumerate}
    \item 所有零行都位于矩阵的底部；
    \item 在每一个非零行中，第一个非零元素（称主元）总是出现在上一行主元的右侧；
    \item 每一个非零行的主元都是$1$；
    \item \textcolor{red}{一个主元所在的列的其他元素都是$0$}。
\end{enumerate}

简化行阶梯形和行阶梯形矩阵的主要区别在于最后一条。

\end{definition}

一般地，我们称\textcolor{second}{“先通过行变换将矩阵化为上三角形，然后进一步做行变换，将其化为简化行阶梯形矩阵进而直接\textbf{读出}方程组的解”}这样的解方程的方法为\textcolor{third}{\bf 高斯-若尔当消元法}。可以证明，任何矩阵都可以通过高斯-若尔当消元法转换为简化行阶梯形形式。高斯-若尔当消元法实际上是高斯消元法的一个扩展。

\subsection{使用Python解方程组}
\label{subsec:使用Python解方程组}

使用Python可以很轻松地解出方程组\ref{eq:二元一次方程组示例}。

\lstinputlisting[language=python]{scripts/code-1-1-4.py}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{通用符号}

\begin{note}
    本节最重要却最容易忽略的一点：数学文本中，如无特殊说明，则一般认为向量都是\textcolor{red}{列向量}。
\end{note}

\subsection{向量}
我们记$\boldsymbol{x}\in \mathbb{R}^n$为一个 $n$ 维的向量, 其中 $x_i \in \mathbb{R}$ 是第 $i$ 维的元素:
$$
\boldsymbol{x}=\left(\begin{array}{c}
x_1 \\
x_2 \\
\vdots \\
x_n
\end{array}\right) \in \mathbb{R}^n
$$

\subsection{矩阵}
我们记 $A \in \mathbb{R}^{m \times n}$ 为一个 $m$ 行 $n$ 列的矩阵, 其中 $a_{i, j} \in \mathbb{R}$ 是第 $i$ 行 $j$ 列的元素:
$$
A=\left(\begin{array}{ccc}
a_{1,1} & \cdots & a_{1, n} \\
\vdots & & \vdots \\
a_{m, 1} & \cdots & a_{m, n}
\end{array}\right) \in \mathbb{R}^{m \times n}
$$

注意: 如上定义的向量 $\boldsymbol{x}$ 可以被看做是一个 $n \times 1$ 的矩阵，常被称为一个列向量。


\subsection{单位矩阵}

单位矩阵 $I \in \mathbb{R}^{n \times n}$ 是一个方阵其对角线上均是 1 其余位置均为 0 。
$$
I=\left(\begin{array}{cccc}
1 & 0 & \cdots & 0 \\
0 & \ddots & \ddots & \vdots \\
\vdots & \ddots & \ddots & 0 \\
0 & \cdots & 0 & 1
\end{array}\right)
$$

注: 对所有矩阵 $A \in \mathbb{R}^{n \times n}$, 我们有 $A \times I=I \times A=A$ （\textcolor{red}{讲完矩阵乘法回来解释该式}）。


\subsection{对角阵}

对角阵 $D \in \mathbb{R}^{n \times n}$ 是一个方阵其对角线上元素均是非零值, 其余位置均为 0 。
$$
D=\left(\begin{array}{cccc}
d_1 & 0 & \cdots & 0 \\
0 & \ddots & \ddots & \vdots \\
\vdots & \ddots & \ddots & 0 \\
0 & \cdots & 0 & d_n
\end{array}\right)
$$

注: 我们记 $D$ 为 $\operatorname{diag}\left(d_1, \ldots, d_n\right)$ 。

\subsection{三角矩阵}

三角矩阵（triangular matrix）因其非零系数的排列呈三角形状而得名。

一个如下形状的矩阵：
$$
\mathbf{L}=\left[\begin{array}{ccccc}
l_{1,1} & & \ldots & & 0 \\
l_{2,1} & l_{2,2} & & (0) & \\
l_{3,1} & l_{3,2} & \ddots & & \vdots \\
\vdots & \vdots & \ddots & \ddots & \\
l_{n, 1} & l_{n, 2} & \ldots & l_{n, n-1} & l_{n, n}
\end{array}\right]
$$

被称为下三角矩阵; 同样的, 一个如下形状的矩阵:

$$
\mathbf{U}=\left[\begin{array}{ccccc}
u_{1,1} & u_{1,2} & u_{1,3} & \ldots & u_{1, n} \\
& u_{2,2} & u_{2,3} & \ldots & u_{2, n} \\
\vdots & & \ddots & \ddots & \vdots \\
& (0) & & \ddots & u_{n-1, n} \\
0 & & \ldots & & u_{n, n}
\end{array}\right]
$$

被称为上三角矩阵。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{从线性变换到矩阵}
%参考高中数学选修4-2中的例子
\label{sec:从线性变换到矩阵}

\begin{note}
    矩阵与线性变换通过一次方程组建立联系。事实上，在直角坐标系 $O x y$ 中, 所有满足“线性”性质的几何变换都具有形式
$$
\left\{\begin{array}{l}
x^{\prime}=a x+b y, \\
y^{\prime}=c x+d y,
\end{array}\right.
$$

其中 $a, b, c, d$ 均为常数. 该变换可以由二阶矩阵 $\left(\begin{array}{ll}a & b \\ c & d\end{array}\right)$ 完全确定.
\end{note}

本节将以矩阵为工具, 研究一些几何变换, 并以平面图形的变换为背景, 讨论二阶矩阵的乘法及性质, 用变换的观点理解解二元一次方程组的意义, 初步展示矩阵应用的广泛性。

\subsection{几种特殊几何变换}

\subsubsection{恒等变换}
\label{subsubsec:恒等变换}

相传，在古希腊德尔斐的阿波罗神庙中，刻有“认识你自己”这句箴言，它鼓励人们深入探索自我，以实现更深层次的理解和个人成长。

这句古老的箴言也在数学中找到了回音。我们在定义任何数学对象之间的关系时，一定要先思考这种关系在对象和它自身之间是否是存在的。比如，实数相等和不相等的关系，就需要建立在每个实数都和它自身相等的基础上。

我们在研究平面上的几何变换时也有类似的概念，这就是本节要介绍的\textcolor{third}{\bf 恒等变换}，它是一种将一个对象变换为其自身的变换。这意味着，在这种变换下，对象保持不变。

 在直角坐标系 $O x y$ 内, 恒等变换将每个点都映射为它自身（即相当于没有发生变化）. 设点 $P(x, y)$ 经过恒等变换后变成点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$，则 $x^{\prime}, y^{\prime}$ 与 $x, y$ 有如下关系：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=x, \\
y^{\prime}=y .
\end{array}\right.
\label{eq:恒等变换的表达式}
\end{equation}

我们将式(\ref{eq:恒等变换的表达式})称为恒等变换的表达式。对式\ref{eq:恒等变换的表达式}进行简单改写，如式\ref{eq:恒等变换的方程}所示：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=x + 0\cdot y, \\
y^{\prime}= 0\cdot x + y .
\end{array}\right.
\label{eq:恒等变换的方程}
\end{equation}

故其系数矩阵为：

\begin{equation}
\left(\begin{array}{rr}
1  & 0 \\
0  & 1
\end{array}\right)
\label{eq:恒等变换矩阵}
\end{equation}

可见，恒等变换的表达式的系数矩阵正好是一个单位矩阵，因此我们将单位矩阵称为恒等变换的\textcolor{third}{变换矩阵}。单位矩阵也唯一确定了一种变换，即恒等变换。因此，在讨论数学问题时，你常常能听到人们指着单位矩阵说：“这是一个恒等变换”。

\subsubsection{旋转变换}
\label{subsubsec:旋转变换}

在第\ref{subsubsec:恒等变换}节中，我们已经得到了平面上的点到它自身的变换，现在我们可以开始研究平面上的点到其他与它不同的点的变换了。

如图 \ref{fig:旋转变换} 所示, 在直角坐标系 $O x y$ 内, 每个点都绕原点 $O$ 按逆时针方向旋转 $180^{\circ}$. 设点 $P(x, y)$ 经过旋转后变成点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$，则 $x^{\prime}, y^{\prime}$ 与 $x, y$ 有如下关系：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=-x, \\
y^{\prime}=-y .
\end{array}\right.
\label{eq:旋转变换的表达式}
\end{equation}

我们将式(\ref{eq:旋转变换的表达式})称为旋转角为 $180^{\circ}$ 的\textcolor{third}{\bf 旋转变换}的表达式, 它建立了平面内的每个点 $P$ 到其对应点 $P^{\prime}$ 的对应关系, 我们称 $P^{\prime}$ 是 $P$ 在这个旋转变换作用下的像.

\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.5]
    % 绘制坐标轴
    \draw[->] (-1.5,0) -- (1.5,0) node[right] {$x$};
    \draw[->] (0,-1.5) -- (0,1.5) node[above] {$y$};
    
    % 绘制旋转前的点P
    \coordinate (P) at (1,1);
    \fill (P) circle (2pt) node[anchor=south west] {$P(x, y)$};
    
    % 绘制旋转后的点P'
    \coordinate (P') at (-1,-1);
    \fill (P') circle (2pt) node[anchor=north east] {$P'(x', y')$};
    
    % 绘制连接线和旋转弧
    \draw[dashed] (P) -- (P');
    \draw[->] (0,0) +(45:0.3) arc (45:225:0.3);
    
    % 添加标签
    \node at (-0.5,0.5) {$180^\circ$};
\end{tikzpicture}
\caption{旋转变换示意图\label{fig:旋转变换}}
\end{figure}

我们可以对式\ref{eq:旋转变换的表达式}进行简单改写，如式\ref{eq:旋转变换的方程}所示：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=-1 \cdot x + 0\cdot y, \\
y^{\prime}= 0\cdot x + -1 \cdot y .
\end{array}\right.
\label{eq:旋转变换的方程}
\end{equation}

故其系数矩阵为：

\begin{equation}
\left(\begin{array}{rr}
-1  & 0 \\
0  & -1
\end{array}\right)
\label{eq:旋转变换示例矩阵}
\end{equation}

显然，在二维平面内旋转$180^{\circ}$这一变换可以由式\ref{eq:旋转变换示例矩阵}唯一确定。反过来，该矩阵也可以唯一确定这个变换。

\begin{exercise}
 
在直角坐标系 $O x y$ 内, 将每个点绕原点 $O$ 按逆时针方向旋转 $30^{\circ}$ 的变换称为旋转角是 $30^{\circ}$ 的旋转变换.

\vspace{0.5cm}

\begin{itemize}
    \item 求点 $A(1,0)$ 在这个旋转变换作用下的像 $A^{\prime}$;
    \item 写出这个旋转变换的表达式.
\end{itemize}
\end{exercise}

\begin{solution}
\begin{itemize}
    \item 点 $A(1,0)$ 在这个旋转变换作用下的像为$A^{\prime}\left(\frac{\sqrt{3}}{2}, \frac{1}{2}\right)$;
    \item $\left\{\begin{array}{l}x^{\prime}=\frac{\sqrt{3}}{2} x-\frac{1}{2} y, \\ y^{\prime}=\frac{1}{2} x+\frac{\sqrt{3}}{2} y .\end{array}\right.$
\end{itemize}
\end{solution}

\vspace{0.5cm}

事实上, 在直角坐标系 $O x y$ 内, 将任意一点$P(x, y)$绕原点 $O$ 按逆时针方向旋转 $\alpha$ 角得到点$P^{\prime}(x^{\prime}, y^{\prime})$的旋转变换的坐标变换公式是

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=x \cos \alpha-y \sin \alpha, \\
y^{\prime}=x \sin \alpha+y \cos \alpha .
\end{array}\right.    
\end{equation}

\subsubsection{反射变换}
\label{subsubsec:反射变换}

如图 \ref{fig:反射变换} 所示, 在直角坐标系 $O x y$ 内, 关于 $x$ 轴的反射变换把任意一点 $P(x, y)$ 变成它关于 $x$ 轴的对称点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$。此时 $x^{\prime}, y^{\prime}$ 与 $x, y$ 有如下关系：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=-x, \\
y^{\prime}=y .
\end{array}\right.
\label{eq:反射变换的表达式}
\end{equation}

\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.5]
    % 绘制坐标轴
    \draw[->] (-1.5,0) -- (1.5,0) node[right] {$x$};
    \draw[->] (0,-1.5) -- (0,1.5) node[above] {$y$};
    
    % 绘制旋转前的点P
    \coordinate (P) at (1,1);
    \fill (P) circle (2pt) node[anchor=south west] {$P(x, y)$};
    
    % 绘制旋转后的点P'
    \coordinate (P') at (-1,1);
    \fill (P') circle (2pt) node[anchor=north east] {$P'(x', y')$};
    
    % 绘制连接线和旋转弧
    \draw[dashed] (P) -- (P');
    
\end{tikzpicture}
\caption{反射变换示意图\label{fig:反射变换}}
\end{figure}

我们将式(\ref{eq:反射变换的表达式})称为关于 $x$ 轴的\textcolor{third}{\bf 反射变换}的表达式。我们可以对式\ref{eq:反射变换的表达式}进行简单改写，如式\ref{eq:反射变换的方程}所示：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=1 \cdot x + 0\cdot y, \\
y^{\prime}= 0\cdot x + -1 \cdot y .
\end{array}\right.
\label{eq:反射变换的方程}
\end{equation}

故其系数矩阵为：

\begin{equation}
\left(\begin{array}{rr}
1  & 0 \\
0  & -1
\end{array}\right)
\label{eq:反射变换示例矩阵}
\end{equation}

% 我们把矩阵\ref{eq:反射变换示例矩阵}称为该变换对应的\textcolor{third}{\bf 变换矩阵}。

\vspace{0.5cm}

\begin{exercise}
\begin{enumerate}
    \item 关于 \textbf{$y$ 轴}的反射变换把直角坐标系 $O x y$ 内的任意一点 $P(x, y)$ 变成它关于 $y$ 轴的对称点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$. 相应的坐标变换公式和变换矩阵分别是什么？
    \item 关于 \textbf{直线$y=x$}的反射变换把直角坐标系 $O x y$ 内的任意一点 $P(x, y)$ 变成它关于直线$y=x$的对称点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$. 相应的坐标变换公式和变换矩阵分别是什么？
\end{enumerate}
\end{exercise}

\begin{solution}

\begin{enumerate}
    \item 关于 \textbf{$y$ 轴}的反射变换，其相应的坐标变换公式是
$$
\left\{\begin{array}{c}
x^{\prime}=-x, \\
y^{\prime}=y .
\end{array}\right.
$$

对应的变换矩阵是：

$$
 \left(\begin{array}{cc}-1 & 0 \\ 0 & 1\end{array}\right)
$$
\item 关于 \textbf{直线$y=x$} 的反射变换，其相应的坐标变换公式是
$$
\left\{\begin{array}{c}
x^{\prime}=y, \\
y^{\prime}=x .
\end{array}\right.
$$

对应的变换矩阵是：

$$
 \left(\begin{array}{cc}0 & 1 \\ 1 & 0\end{array}\right)
$$
\end{enumerate}
\end{solution}

\subsubsection{伸缩变换}
\label{subsubsec:伸缩变换}

在直角坐标系 $O x y$ 内，将任意一点 $P(x, y)$ 的纵坐标变为原来的 2 ，横坐标不变，得到点 $P^{\prime}\left(x^{\prime}, y^{\prime}\right)$。此时 $x^{\prime}, y^{\prime}$ 与 $x, y$ 有如下关系：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=x \\
y^{\prime}=2 y
\end{array}\right.
\label{eq:伸缩变换的表达式}
\end{equation}

像这样的，将直角坐标系 $O x y$ 内每个点的横坐标变为原来的 $k_1$ 倍, 纵坐标变为原来的 $k_2$ 倍, 其中 $k_1, k_2$ 均为非零常数, 我们称这样的几何变换为\textcolor{third}{\bf 伸缩变换} (stretching)，式(\ref{eq:伸缩变换的表达式})称为该伸缩变换的表达式。我们可以对式(\ref{eq:伸缩变换的表达式})进行改写，得到式：

\begin{equation}
\left\{\begin{array}{l}
x^{\prime}=x  + 0 \cdot y\\
y^{\prime}=0 \cdot x + 2 y
\end{array}\right.
\label{eq:伸缩变换的方程}
\end{equation}

故其系数矩阵为：

\begin{equation}
\left(\begin{array}{rr}
1  & 0 \\
0  & 2
\end{array}\right)
\label{eq:伸缩变换示例矩阵}
\end{equation}

一般地，将每个点的横坐标变为原来的 $k_1$ 倍, 纵坐标变为原来的 $k_2$ 倍 $\left(k_1, k_2\right.$ 均为非零常数) 的伸缩变换, 其坐标变换公式是

\begin{equation}
    \left\{\begin{array}{l}
x^{\prime}=k_1 x, \\
y^{\prime}=k_2 y .
\end{array}\right.
\label{伸缩变换一般表达式}
\end{equation}

对应的变换矩阵为 

\begin{equation}
\left(\begin{array}{cc}k_1 & 0 \\ 0 & k_2\end{array}\right).
\label{伸缩变换一般矩阵}
\end{equation}


\subsubsection{投影变换}
\label{subsubsec:投影变换}

\subsubsection{切变变换}
\label{subsubsec:切变变换}

\section{矩阵的运算}

\begin{note}
这一节主要是要让学生明白向量/矩阵的乘法核心是\textcolor{red}{“行乘列”}。
\end{note}

\subsection{向量与向量间的乘法运算}

存在两种类型的向量与向量的乘积：内积和外积。

\begin{definition}[内积] \label{def:inner-product} 
对 $x, y \in \mathbb{R}^n$, 我们有:
$$
x^T y=\sum_{i=1}^n x_i y_i \in \mathbb{R}
$$
\end{definition}

\begin{exercise}\label{exer:01}
假设我们有两个二维向量 $x = \begin{bmatrix} 1 \\ 2 \end{bmatrix}$ 和 $y = \begin{bmatrix} 3 \\ 4 \end{bmatrix}$。我们可以使用定义 \ref{def:inner-product} 中的公式来计算它们的内积：

\[
x^T y = x y^T = \begin{bmatrix} 1 & 2 \end{bmatrix} \begin{bmatrix} 3 \\ 4 \end{bmatrix} = (1 \cdot 3) + (2 \cdot 4) = 3 + 8 = 11
\]

因此，向量 $x$ 和 $y$ 的内积为 $11$。
\end{exercise}

\begin{definition}[外积] \label{def:outer-product} 
对 $x \in \mathbb{R}^m, y \in \mathbb{R}^n$, 我们有:
$$
x y^T=\left(\begin{array}{ccc}
x_1 y_1 & \cdots & x_1 y_n \\
\vdots & & \vdots \\
x_m y_1 & \cdots & x_m y_n
\end{array}\right) \in \mathbb{R}^{m \times n}
$$
\end{definition}

\begin{exercise}
    假设我们有一个列向量 $x = \begin{bmatrix} 1 \\ 2 \end{bmatrix}$ 和一个三维向量 $y = \begin{bmatrix} 3 \\ 4 \\ 5 \end{bmatrix}$。我们可以使用定义 \ref{def:outer-product} 中的公式来计算它们的外积：

\[
x y^T = \begin{bmatrix} 1 \\ 2 \end{bmatrix} \begin{bmatrix} 3 & 4 & 5 \end{bmatrix}
\]

计算这个外积：

\[
x y^T = \begin{bmatrix}
1 \cdot 3 & 1 \cdot 4 & 1 \cdot 5 \\
2 \cdot 3 & 2 \cdot 4 & 2 \cdot 5 \\
\end{bmatrix} = \begin{bmatrix}
3 & 4 & 5 \\
6 & 8 & 10 \\
\end{bmatrix}
\]

因此，列向量 $x$ 和三维向量 $y$ 的外积是一个 $2 \times 3$ 的矩阵。
\end{exercise}

\subsection{矩阵与向量间的乘法运算}

\begin{definition}[矩阵与向量间的乘法运算] \label{def:mat-vec-multi}

矩阵 $A \in \mathbb{R}^{m \times n}$ 和向量 $x \in \mathbb{R}^n$ 的乘积是一个大小为 $\mathbb{R}^m$ 的向量, 满足:

$$
A x=\left(\begin{array}{c}
a_{r, 1}^T x \\
\vdots \\
a_{r, m}^T x
\end{array}\right)=\sum_{i=1}^n a_{c, i} x_i \in \mathbb{R}^m
$$

其中 $a_{r, i}^T$ 是行向量, $a_{c, j}$ 是 $A$ 的列向量, $x_i$ 是 $x$ 的元素。
\end{definition}

\begin{exercise}
    假设我们有一个2x3的矩阵 $A$ 与一个3维向量 $x$ 相乘。

矩阵 $A$ 和向量 $x$ 的值如下：

\[
A = \begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{bmatrix}
\]

\[
x = \begin{bmatrix}
2 \\
3 \\
1 \\
\end{bmatrix}
\]

现在，让我们根据定义，计算 $Ax$ 的乘积：

\[
Ax = \begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{bmatrix} \begin{bmatrix}
2 \\
3 \\
1 \\
\end{bmatrix}
\]

我们首先计算每一行与向量 $x$ 的内积，然后将结果组合成一个新的向量：

1. 第一行与 $x$ 的内积： $a_{1,1}^T x = \begin{bmatrix} 1 & 2 & 3 \end{bmatrix} \begin{bmatrix} 2 \\ 3 \\ 1 \end{bmatrix} = 1 \cdot 2 + 2 \cdot 3 + 3 \cdot 1 = 2 + 6 + 3 = 11$

2. 第二行与 $x$ 的内积： $a_{2,1}^T x = \begin{bmatrix} 4 & 5 & 6 \end{bmatrix} \begin{bmatrix} 2 \\ 3 \\ 1 \end{bmatrix} = 4 \cdot 2 + 5 \cdot 3 + 6 \cdot 1 = 8 + 15 + 6 = 29$

因此，$Ax$ 的结果是一个大小为 $\mathbb{R}^2$ 的向量，其元素分别是 $11$ 和 $29$。
\end{exercise}

\subsection{矩阵与矩阵间的乘法运算}

\begin{definition}[矩阵和矩阵的乘法] \label{def:mat-mat-multi}
    
矩阵 $A \in \mathbb{R}^{m \times n}$ 和 $B \in \mathbb{R}^{n \times p}$ 的乘积是一个大小为 $\mathbb{R}^{n \times p}$ 的矩阵, 满足:

$$
A B=\left(\begin{array}{ccc}
a_{r, 1}^T b_{c, 1} & \cdots & a_{r, 1}^T b_{c, p} \\
\vdots & & \vdots \\
a_{r, m}^T b_{c, 1} & \cdots & a_{r, m}^T b_{c, p}
\end{array}\right)=\sum_{i=1}^n a_{c, i} b_{r, i}^T \in \mathbb{R}^{n \times p}
$$

其中 $a_{r, i}^T, b_{r, i}^T$ 是行向量, $a_{c, j}, b_{c, j}$ 分别是 $A$ 和 $B$ 的列向量。
\end{definition}

\begin{exercise}
    我们将使用一个2x3的矩阵 $A$ 与一个3x2的矩阵 $B$ 相乘。

首先，让我们定义矩阵 $A$ 和矩阵 $B$：

\[
A = \begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{bmatrix}
\]

\[
B = \begin{bmatrix}
2 & 3 \\
4 & 5 \\
6 & 7 \\
\end{bmatrix}
\]

现在，让我们使用这个新的矩阵 $B$ 与之前定义的矩阵 $A$ 相乘，以演示矩阵乘法的过程：

\[
AB = \begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{bmatrix} \begin{bmatrix}
2 & 3 \\
4 & 5 \\
6 & 7 \\
\end{bmatrix}
\]

计算每一行与每一列的内积，并生成新的矩阵 $AB$：

1. 第一行与第一列的内积： $a_{1,1}^T b_{1,1} = \begin{bmatrix} 1 & 2 & 3 \end{bmatrix} \begin{bmatrix} 2 \\ 4 \\ 6 \end{bmatrix} = 1 \cdot 2 + 2 \cdot 4 + 3 \cdot 6 = 2 + 8 + 18 = 28$

2. 第一行与第二列的内积： $a_{1,1}^T b_{2,1} = \begin{bmatrix} 1 & 2 & 3 \end{bmatrix} \begin{bmatrix} 3 \\ 5 \\ 7 \end{bmatrix} = 1 \cdot 3 + 2 \cdot 5 + 3 \cdot 7 = 3 + 10 + 21 = 34$

3. 第二行与第一列的内积： $a_{2,1}^T b_{1,1} = \begin{bmatrix} 4 & 5 & 6 \end{bmatrix} \begin{bmatrix} 2 \\ 4 \\ 6 \end{bmatrix} = 4 \cdot 2 + 5 \cdot 4 + 6 \cdot 6 = 8 + 20 + 36 = 64$

4. 第二行与第二列的内积： $a_{2,1}^T b_{2,1} = \begin{bmatrix} 4 & 5 & 6 \end{bmatrix} \begin{bmatrix} 3 \\ 5 \\ 7 \end{bmatrix} = 4 \cdot 3 + 5 \cdot 5 + 6 \cdot 7 = 12 + 25 + 42 = 79$

因此，$AB$ 的结果是一个大小为 $\mathbb{R}^{2 \times 2}$ 的矩阵，其元素如下：

\[
AB = \begin{bmatrix}
28 & 34 \\
64 & 79 \\
\end{bmatrix}
\]

\end{exercise}

\textcolor{red}{\bf 讲到这里记得回去解释单位矩阵的定义。}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{矩阵算子}

\subsection{矩阵的转置}

\begin{definition}
    
矩阵 $A \in \mathbb{R}^{m \times n}$ 的转置, 记作 $A^T$, 是其中元素的翻转
$$
\forall i, j, \quad A_{i, j}^T=A_{j, i}
$$
\end{definition}

\begin{exercise}
    假设我们有一个 $2 \times 3$ 的矩阵：

$$
A = \begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{bmatrix}
$$

现在，让我们计算矩阵 $A$ 的转置 $A^T$。转置操作将原矩阵的行变成列，列变成行，如下所示：

$$
A^T = \begin{bmatrix}
1 & 4 \\
2 & 5 \\
3 & 6 \\
\end{bmatrix}
$$

这里，我们可以清晰地看到原始矩阵 $A$ 的行变成了 $A^T$ 的列，而原始矩阵的列变成了 $A^T$ 的行。

\end{exercise}

\begin{theorem}[转置运算的性质] \label{thm:transpose-property}
    对矩阵 $A, B$, 我们有 $(A B)^T=B^T A^T$。\textcolor{red}{（提示：想一下矩阵相乘的尺寸对齐关系）}
\end{theorem}

\subsection{矩阵的逆}

\begin{definition} \label{def:invertible-mat}
    给定一个 $n$ 阶方阵 $\mathbf{A}$, 若存在一个 $n$ 阶方阵 $\mathbf{B}$, 使得 $\mathbf{A B}=\mathbf{B} \mathbf{A}=\mathbf{I}_n$, 其中 $\mathbf{I}_n$ 为 $n$ 阶单位矩阵, 则称 $\mathbf{A}$ 是可逆的, 且 $\mathbf{B}$ 是 $\mathbf{A}$ 的逆矩 阵, 记作 $\mathbf{A}^{-1}$ 。
\end{definition}

根据定义\ref{def:invertible-mat}，有
$$
A A^{-1}=A^{-1} A=I
$$

不是所有方阵都是可逆的。不可逆矩阵也叫奇异矩阵或退化矩阵，它们的特点是行列式的值为0。下面是一些不可逆矩阵的例子：

\begin{enumerate}
\item 全零矩阵：
   \[
   \begin{bmatrix}
   0 & 0 \\
   0 & 0 \\
   \end{bmatrix}
   \]

\item 含有线性相关行或列的矩阵：
   \[
   \begin{bmatrix}
   1 & 2 \\
   2 & 4 \\
   \end{bmatrix}
   \]

\item 非方矩阵也是不可逆的，例如：
   \[
   \begin{bmatrix}
   1 & 2 \\
   \end{bmatrix}
   \]

\item 任何行或列全为0的矩阵，例如：
   \[
   \begin{bmatrix}
   1 & 0 \\
   0 & 0 \\
   \end{bmatrix}
   \]
\end{enumerate}

这些例子中的矩阵都不能找到一个逆矩阵来满足矩阵乘法的单位矩阵条件。

\begin{theorem}[矩阵的逆运算的性质]
    对可逆矩阵 $A, B$, 我们有 $(A B)^{-1}=B^{-1} A^{-1}$。\textcolor{red}{（提示：套定义和原矩阵相乘就可以证明）}
\end{theorem}

使用Python求矩阵的逆：

\lstinputlisting[language=Python]{scripts/code-unnamed-用python求解矩阵的逆.py}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{函数与优化}

在数学中，\textcolor{main}{\bf 函数}是一个基本但强大的工具，它简单地将每一个输入值映射到一个输出值。你可以将它想象为一个机器：你放进一个数（输入），它便会给你另一个数（输出）。

接下来我们将探讨\textcolor{main}{\bf 优化}的概念，它涉及到一个目标函数的最大化或最小化过程，帮助我们在可能的解决方案中找到“最优”的一种。在现实生活中，这可以是找到最省钱的购物清单，或是找到最快的到达目的地的路线。

在本章中，我们将初步探讨函数和优化的基本理论，为你打开一扇理解和掌握这两个强大工具的大门，从而在实际应用中找到最佳的解决方案。

\section{函数的定义和性质}
\subsection{函数的定义}

\begin{note}
    函数是一种数学关系，它将一个集合的元素映射到另一个集合的元素。
\end{note}

\begin{definition}[函数]
给定两个\textcolor{red}{实数集} $D$ 和 $M$, 若有\textcolor{red}{对应法则} $f$, 使对 $D$ 内每一个数 $x$,都有\textcolor{red}{唯一}的一个数 $y \in M$ 与它相对应,则称 $f$ 是定义在数集 $D$上的\textcolor{third}{\bf 函数}，记作
\begin{equation}
\begin{aligned}
    f:D & \rightarrow M, \\
    x & \mapsto y.
\end{aligned}
\end{equation}

数集$D$称为函数$f$的\textcolor{third}{\bf 定义域}，$x$所对应的数$y$称为$f$在点$x$的\textcolor{third}{\bf 函数值}，常记为$f(x)$.全体函数值的集合

\begin{equation*}
    f(D) = \{y\mid y=f(x),x\in D\} (\subset M)
\end{equation*}

成为函数$f$的\textcolor{third}{\bf 值域}.

\end{definition}

% 其中，$f(x)$ 表示函数 $f$ 对于\textcolor{third}{\bf 输入} $x$ 的\textcolor{third}{\bf 输出}；$D(f)$ 表示函数的\textcolor{third}{\bf 定义域}（domain），即函数可以接受的输入值的集合；$R(f)$ 表示函数的\textcolor{third}{\bf 值域}（range），即函数实际输出的值的集合。


%TODO%
关于函数的定义，我们做如下几点说明：

\begin{enumerate}
    \item 什么是函数相同？相同的函数形式可能不同；
    \item 使运算式子有意义的自变量值的全体，成为存在域。函数的定义域常取存在域；
    \item 函数是一种映射关系，要素有原象和象；
    \item 在函数定义中, 对每一个 $x \in D$, 只能有唯一的一个 $y$ 值与它对应, 这样 定义的函数称为\textcolor{third}{\bf 单值函数}. 若同一个 $x$ 值可以对应多于一个的 $y$ 值, 则称这种函数为\textcolor{third}{\bf 多值函数}. 在本讲义范围内, 我们只讨论单值函数.
\end{enumerate}

\subsection{具有某些特性的函数}

\subsubsection{有界函数}

\begin{definition}[有上 (下) 界函数]
    设 $f$ 为定义在 $D$ 上的函数. 若存在数 $M(L)$, 使得对每一个 $x \in D$ 有
    $$
    f(x) \leqslant M(f(x) \geqslant L),
    $$
    则称 $f$ 为 $D$ 上的\textcolor{third}{\bf 有上 (下) 界函数}, $M(L)$ 称为 $f$ 在 $D$ 上的一个\textcolor{third}{\bf 上 (下) 界}.
\end{definition}

根据定义, $f$ 在 $D$ 上有上 (下) 界, 意味着值域 $f(D)$ 是一个有上 (下) 界的数 集. 又若 $M(L)$ 为 $f$ 在 $D$ 上的上 (下) 界, 则任何大于 (小于) $M(L)$ 的数也是 $f$ 在 $D$ 上的上(下) 界.

\begin{definition}[有界函数]
    设 $f$ 为定义在 $D$ 上的函数. 若存在正数 $M$, 使得对每一个 $x \in D$ 有
    \begin{equation}
    \mid f(x)\mid \leqslant M \text {, }
    \label{eq:有界函数的定义}
    \end{equation}
    
    则称 $f$ 为 $D$ 上的\textcolor{third}{\bf 有界函数}.
\end{definition}

$f$ 在 $D$ 上有界的充要条件是 $f$ 在 $D$ 上既有上界又有下界. (\ref{eq:有界函数的定义})式的几何意义 是: 若 $f$ 为 $D$ 上的有界函数, 则 $f$ 的图像完全落在直线 $y=M$ 与 $y=-M$ 之间.

\vspace{0.5cm}
\begin{exercise}
    证明正弦函数 $\sin x$ 和余弦函数 $\cos x$ 为 $\mathbf{R}$ 上的有界函数。
\end{exercise}
\vspace{0.5cm}

关于函数 $f$ 在数集 $D$ 上无上界、无下界或无界的定义, 可按上述相应定义的否定说法来叙述. 例如, 设 $f$ 为定义在 $D$ 上的函数, 若对任何 $M$ (无论 $M$ 多大), 都存在 $x_0 \in D$, 使得 $f\left(x_0\right)>M$, 则称 $f$ 为 $D$ 上的无上界函数.

\vspace{0.5cm}
\begin{exercise}
    证明 $f(x)=\frac{1}{x}$ 为 $(0,1]$ 上的无上界函数.
\end{exercise}
\vspace{0.5cm}

\subsubsection{单调函数}

如果一个函数 \( f(x) \) 在某个区间 \( I \) （interval）内单调增加或单调减少，那么该函数在该区间内具有单调性。

\begin{itemize}
    \item \textbf{单调递增}\quad 如果 \( x_1 < x_2 \) 则 \( f(x_1) < f(x_2) \);
    \item \textbf{单调递减}\quad 如果 \( x_1 < x_2 \) 则 \( f(x_1) > f(x_2) \).
\end{itemize}

若不等号严格成立，就称为严格单调递增（减）函数。

\subsubsection{奇偶性}

奇函数和偶函数是两种特殊类型的函数，它们具有特定的对称性质。

\begin{definition}[奇函数]
    如果一个函数 \( f(x) \) 满足 \( f(x) = -f(-x) \)，那么它被称为奇函数。奇函数关于原点对称。
\end{definition}

\begin{definition}[偶函数]
    如果一个函数 \( f(x) \) 满足 \( f(x) = f(-x) \)，那么它被称为偶函数。偶函数关于 y 轴对称。
\end{definition}


\subsubsection{周期性}
如果一个函数 \( f(x) \) 满足 \( f(x + P) = f(x) \)，其中 \( P \) 是一个常数，那么该函数是周期函数，\( P \) 被称为函数的周期。
\[ f(x + P) = f(x) \]


\subsection{初等函数}

我们在中学接触过的基本初等函数有以下六类：

\begin{table}[h]
\centering
\renewcommand{\arraystretch}{1.5} % 用于增加行高
\begin{tabular}{c|c}
\hline
\rowcolor{gray!50}
\textbf{函数类型} & \textbf{函数表达式} \\
\hline
常量函数 & $y=c \quad (c$ 是常数$)$ \\
\hline
幂函数 & $y=x^\alpha \quad (\alpha$ 为实数$)$ \\
\hline
指数函数 & $y=a^x \quad (a>0, a \neq 1)$ \\
\hline
对数函数 & $y=\log_a x \quad (a>0, a \neq 1)$ \\
\hline
\multirow{4}{*}{三角函数} & $y=\sin x$ (正弦函数) \\
 & $y=\cos x$ (余弦函数) \\
 & $y=\tan x$ (正切函数) \\
 & $y=\cot x$ (余切函数) \\
\hline
\multirow{4}{*}{反三角函数} & $y=\arcsin x$ (反正弦函数) \\
 & $y=\arccos x$ (反余弦函数) \\
 & $y=\arctan x$ (反正切函数) \\
 & $y=\operatorname{arccot} x$ (反余切函数) \\
\hline
\end{tabular}
\end{table}

这里我们要指出,幂函数 $y=x^\alpha$ 和指数函数 $y=a^x$ 都涉及乘幂, 而在中学数 课程中只给出了有理指数乘幂的定义. 下面我们借助确界来定义无理指数幂,

\begin{figure}
    \centering
\begin{tikzpicture}[scale=0.8]
  % Define custom colors
  \definecolor{myred}{rgb}{0.8, 0.2, 0.2}
  \definecolor{myblue}{rgb}{0.2, 0.2, 0.8}
  \definecolor{mygreen}{rgb}{0.0, 0.5, 0.0}
  \definecolor{myorange}{rgb}{1.0, 0.5, 0.0}
  \definecolor{mybrown}{rgb}{0.6, 0.4, 0.2}
  \definecolor{mypurple}{rgb}{0.6, 0.2, 0.6}

  % Draw axes
  \draw[->, thick] (-6,0) -- (6,0) node[right] {$x$};
  \draw[->, thick] (0,-6) -- (0,6) node[above] {$y$};
  
  % Draw grid
  \draw[gray!50, very thin] (-5.9,-5.9) grid[step=1cm] (5.9,5.9);
  
  % Plot constant function f(x) = 1
  \draw[myred, thick, domain=-5:5, samples=2] plot (\x, {1}) node[right] {$f(x)=1$};
  
  % Plot linear function f(x) = x
  \draw[myblue, thick, domain=-4.7:4.7, samples=2] plot (\x, {\x}) node[right] {$f(x)=x$};
  
  % Plot quadratic function f(x) = x^2
  \draw[mygreen, thick, domain=-2.25:2.25, samples=50] plot (\x, {\x*\x}) node[right] {$f(x)=x^2$};

  % Plot quadratic function f(x) = x^3
  \draw[mypurple, thick, domain=-1.7:1.7, samples=50] plot (\x, {\x*\x*\x}) node[left] {$f(x)=x^3$};
  
  % Plot exponential function f(x) = e^x
  \draw[myorange, thick, domain=-2:1.75, samples=50] plot (\x, {exp(\x)}) node[right] {$f(x)=e^x$};
  
  % Plot logarithmic function f(x) = ln(x)
  \draw[mybrown, thick, domain=0.1:5, samples=50] plot (\x, {ln(\x)}) node[right] {$f(x)=\ln(x)$};

  % Mark points
  % \filldraw [black] (1,0) circle (2pt) node[anchor=north west] {(1, 0)};
  \filldraw [black] (0,0) circle (2pt) node[anchor=north west] {(0, 0)};
  % \filldraw [black] (0,1) circle (2pt) node[anchor=north east] {(0, 1)};
  \filldraw [black] (1,1) circle (2pt) node[anchor=south west] {(1, 1)};

\end{tikzpicture}
\caption{基本初等函数的图像}
    \label{fig:basic-elem-func}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Elegant\LaTeX{} 系列模板介绍}

\begin{quotation}
  \textbf{\textcolor{red}{本模板自 2023 年 1 月 1 日开始，不再维护，不建议使用本系列模板！为了保证之前版本的用户仍然能查到说明文档，本说明文档仍然保留过去的信息。}}
\end{quotation}

Elegant\LaTeX{} 项目组致力于打造一系列美观、优雅、简便的模板方便用户使用。目前由 \href{https://github.com/ElegantLaTeX/ElegantNote}{ElegantNote}，\href{https://github.com/ElegantLaTeX/ElegantBook}{ElegantBook}，\href{https://github.com/ElegantLaTeX/ElegantPaper}{ElegantPaper} 组成，分别用于排版笔记，书籍和工作论文。大版本改动较大，请关注版本信息，在未开始使用模板前，建议直接选择最新正式版本！


本文将介绍本模板的一些设置内容以及基本使用方法。如果您有其他问题，建议或者意见，欢迎在 GitHub 上给我们提交 \href{https://github.com/ElegantLaTeX/ElegantBook/issues}{issues} 或者邮件联系我们。我们的联系方式如下，建议加入用户 QQ 群提问，这样能更快获得准确的反馈，加群时请备注 \LaTeX{} 或者 Elegant\LaTeX{} 相关内容。
\begin{itemize}
  \item 官网：\href{https://elegantlatex.org/}{https://elegantlatex.org/}
  \item GitHub 地址：\href{https://github.com/ElegantLaTeX/}{https://github.com/ElegantLaTeX/}
  \item CTAN 地址：\href{https://ctan.org/pkg/elegantbook}{https://ctan.org/pkg/elegantbook}
  \item 下载地址：\href{https://github.com/ElegantLaTeX/ElegantBook/releases}{正式发行版}，\href{https://github.com/ElegantLaTeX/ElegantBook/archive/master.zip}{最新版}
  \item Bilibili：\href{https://space.bilibili.com/516479629}{ElegantLaTeX}
  \item 用户 QQ 群：692108391
\end{itemize}


\section{模板安装与更新}

你可以通过免安装的方式使用本模板，包括在线使用和本地（文件夹内）使用两种方式，也可以通过 \TeX{} 发行版安装使用。

\subsection{在线使用模板}

我们把三套模板全部上传到 \href{https://www.overleaf.com/}{Overleaf} 上了，网络便利的用户可以直接通过 Overleaf 在线使用我们的模板。使用 Overleaf 的好处是无需安装 \TeX{} Live，可以随时随地访问自己的文件。查找模板，请在 Overleaf 模板库里面搜索 \lstinline{elegantlatex} 即可，你也可以直接访问\href{https://www.overleaf.com/latex/templates?addsearch=elegantlatex}{搜索结果}。选择适当的模板之后，将其 \lstinline{Open as Template}，即可把模板存到自己账户下，然后可以自由编辑以及与别人一起协作。更多关于 Overleaf 的介绍和使用，请参考 Overleaf 的\href{https://www.overleaf.com/learn}{官方文档}。

\subsection{本地免安装使用}

\textbf{免安装}使用方法如下：从 GitHub 或者 CTAN 下载最新版，严格意义上只需要类文件 \lstinline{elegantbook.cls}。然后将模板文件放在你的工作目录下即可使用。这样使用的好处是，无需安装，简便；缺点是，当模板更新之后，你需要手动替换 \lstinline{cls} 文件。

\subsection{发行版安装与更新}

本模板测试环境为 
\begin{enumerate}
  \item Win10 + \TeX{} Live 2022；
  \item Ubuntu 20.04 + \TeX{} Live 2022；
  \item macOS Monterey + Mac\TeX{} 2022。
\end{enumerate}

\TeX Live/Mac\TeX{} 的安装请参考啸行的\href{https://github.com/OsbertWang/install-latex-guide-zh-cn/releases/}{一份简短的关于安装 \LaTeX{} 安装的介绍}。

安装 \TeX{} Live 之后，安装后建议升级全部宏包，升级方法：使用 cmd 或 terminal 运行 \lstinline{tlmgr update --all}，如果 tlmgr 需要更新，请使用 cmd 运行 \lstinline{tlmgr update --self}，如果更新过程中出现了中断，请改用 \lstinline{tlmgr update --self --all --reinstall-forcibly-removed} 更新，也即

\begin{lstlisting}
tlmgr update --self 
tlmgr update --all
tlmgr update --self --all --reinstall-forcibly-removed
\end{lstlisting}

更多的内容请参考 \href{https://tex.stackexchange.com/questions/55437/how-do-i-update-my-tex-distribution}{How do I update my \TeX{} distribution?}

\subsection{其他发行版本}

由于宏包版本问题，本模板不支持 C\TeX{} 套装，请务必安装 TeX Live/Mac\TeX{}。更多关于 \TeX{} Live 的安装使用以及 C\TeX{} 与 \TeX{} Live 的兼容、系统路径问题，请参考官方文档以及啸行的\href{https://github.com/OsbertWang/install-latex-guide-zh-cn/releases/}{一份简短的关于安装 \LaTeX{} 安装的介绍}。



\chapter{ElegantBook 设置说明}

本模板基于基础的 book 文类，所以 book 的选项对于本模板也是有效的（纸张无效，因为模板有设备选项）。默认编码为 UTF-8，推荐使用 \TeX{} Live 编译。

\section{语言模式}
本模板内含两套基础语言环境 \lstinline{lang=cn}、\lstinline{lang=en}。改变语言环境会改变图表标题的引导词（图，表），文章结构词（比如目录，参考文献等），以及定理环境中的引导词（比如定理，引理等）。不同语言模式的启用如下：
\begin{lstlisting}
\documentclass[cn]{elegantbook} 
\documentclass[lang=cn]{elegantbook}
\end{lstlisting}

除模板自带的两套语言设定之外，由\textbf{网友}提供的其他语言环境设置如下：
\begin{itemize}
  \item 由 \href{https://github.com/VincentMVV}{VincentMVV} 提供的意大利语翻译 \lstinline{lang=it}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/85}{Italian translation}；
  \item 由 \href{https://github.com/abfek66}{abfek66} 提供的法语翻译 \lstinline{lang=fr}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/85}{Italian translation}；
  % \item 由 \href{https://github.com/stultus}{stultus} 提供的马拉雅拉姆语翻译 \lstinline{lang=}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/90}{Malayalam translation}；
  \item 由 \href{https://github.com/inktvis75}{inktvis75} 提供的荷兰语翻译 \lstinline{lang=nl}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/108}{Dutch Translation}；
  \item 由 \href{https://github.com/palkotamas}{palkotamas} 提供的匈牙利语翻译 \lstinline{lang=hu}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/111}{Hungarian translation}；
  \item 由 Lisa 提供的德语翻译 \lstinline{lang=de}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/113}{Deutsch translation}；
  \item 由 Gustavo A. Corradi 提供的西班牙语的翻译 \lstinline{lang=es}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/133}{Spanish translation}；
  \item 由 \href{https://github.com/Altantsooj}{Altantsooj} 提供的蒙古语的翻译 \lstinline{lang=mn}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/137}{Mongolian translation}；
  \item 由 \href{https://github.com/inusturbo}{inusturbo} 提供的日本语的翻译 \lstinline{lang=jp}，相关讨论见 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/172}{Japanese Translation}。
\end{itemize}



\begin{remark}
以上各个语言的设定均为网友设定，我们未对上述翻译进行过校对，如果有问题，请在对应的 issue 下评论。并且，只有中文环境（\lstinline{lang=cn}）才可以输入中文。
\end{remark}

\section{设备选项}
最早我们在 ElegantNote 模板中加入了设备选项（\lstinline{device}），后来，我们觉得这个设备选项的设置可以应用到 ElegantBook 中\footnote{不过因为 ElegantBook 模板封面图片的存在，在修改页面设计时，需要对图片进行裁剪。}，而且 Book 一般内容比较多，如果在 iPad 上看无需切边，放大，那用户的阅读体验将会得到巨大提升。你可以使用下面的选项将版面设置为 iPad 设备模式\footnote{默认为 normal 模式，也即 A4 纸张大小。}
\begin{lstlisting}
\documentclass[pad]{elegantbook} %or
\documentclass[device=pad]{elegantbook}
\end{lstlisting}

\section{颜色主题}

本模板内置 5 组颜色主题，分别为 \textcolor{structure1}{\lstinline{green}}\footnote{为原先默认主题。}、\textcolor{structure2}{\lstinline{cyan}}、\textcolor{structure3}{\lstinline{blue}}（默认）、\textcolor{structure4}{\lstinline{gray}}、\textcolor{structure5}{\lstinline{black}}。另外还有一个自定义的选项  \lstinline{nocolor}。调用颜色主题 \lstinline{green} 的方法为 
\begin{lstlisting}
\documentclass[green]{elegantbook} %or
\documentclass[color=green]{elegantbook}
\end{lstlisting}


\begin{table}[htbp]
  \caption{ElegantBook 模板中的颜色主题\label{tab:color thm}}
  \centering
  \begin{tabular}{ccccccc}
  \toprule
    & \textcolor{structure1}{green} 
    & \textcolor{structure2}{cyan} 
    & \textcolor{structure3}{blue}
    & \textcolor{structure4}{gray} 
    & \textcolor{structure5}{black} 
    & 主要使用的环境\\
  \midrule
    structure & \ccr{structure1}
    & \ccr{structure2}
    & \ccr{structure3} 
    & \ccr{structure4} 
    & \ccr{structure5} 
    & chapter \ section \ subsection \\
    main      & \ccr{main1}
    & \ccr{main2}
    & \ccr{main3}
    & \ccr{main4}
    & \ccr{main5}
    & definition \ exercise \ problem \\
    second    & \ccr{second1}
    & \ccr{second2}
    & \ccr{second3}
    & \ccr{second4}
    & \ccr{second5}
    & theorem \ lemma \ corollary\\
    third     & \ccr{third1}
    & \ccr{third2}
    & \ccr{third3}
    & \ccr{third4}
    & \ccr{third5}
    & proposition\\
  \bottomrule
  \end{tabular}
\end{table}

如果需要自定义颜色的话请选择 \lstinline{nocolor} 选项或者使用 \lstinline{color=none}，然后在导言区定义 structurecolor、main、second、third 颜色，具体方法如下：
\begin{lstlisting}[tabsize=4]
\definecolor{structurecolor}{RGB}{0,0,0}
\definecolor{main}{RGB}{70,70,70}    
\definecolor{second}{RGB}{115,45,2}    
\definecolor{third}{RGB}{0,80,80}
\end{lstlisting}

\section{封面}

\subsection{封面个性化}

从 3.10 版本开始，封面更加弹性化，用户可以自行选择输出的内容，包括 \lstinline{\title} 在内的所有封面元素都可为空。目前封面的元素有

\begin{table}[htbp]
  \centering
  \caption{封面元素信息}
  \begin{tabular}{p{0.07\textwidth}p{0.15\textwidth}|p{0.07\textwidth}p{0.15\textwidth}|p{0.07\textwidth}p{0.15\textwidth}}
    \hline
    信息 & 命令 & 信息 & 命令 & 信息 & 命令 \\
    \hline
    标题 & \lstinline|\title| & 副标题 & \lstinline|\subtitle| & 作者 & \lstinline|\author| \\
    机构 & \lstinline|\institute| & 日期 &  \lstinline|\date| & 版本 & \lstinline|\version| \\
    箴言 & \lstinline|\extrainfo| & 封面图 & \lstinline|\cover| & 徽标 & \lstinline|\logo| \\
    \hline
  \end{tabular}
\end{table}

另外，额外增加一个 \lstinline{\bioinfo} 命令，有两个选项，分别是信息标题以及信息内容。比如需要显示{\kaishu User Name：111520}，则可以使用 
\begin{lstlisting}
\bioinfo{User Name}{115520}
\end{lstlisting}

封面中间位置的色块的颜色可以使用下面命令进行修改：
\begin{lstlisting}
\definecolor{customcolor}{RGB}{32,178,170}
\colorlet{coverlinecolor}{customcolor}
\end{lstlisting}

\subsection{封面图}

本模板使用的封面图片来源于 \href{https://pixabay.com/en/tea-time-poetry-coffee-reading-3240766/}{pixabay.com}\footnote{感谢 China\TeX{} 提供免费图源网站，另外还推荐 \href{https://www.pexels.com/}{pexels.com}。}，图片完全免费，可用于任何场景。封面图片的尺寸为 $1280 \times 1024$, 更换图片的时候请\textbf{严格}按照封面图片尺寸进行裁剪。推荐一个免费的在线图片裁剪网站 \href{https://www.fotor.com/cn}{fotor.com}。用户 QQ 群内有一些合适尺寸的封面，欢迎取用。

\subsection{徽标}

本文用到的 Logo 比例为 1:1，也即正方形图片，在更换图片的时候请选择合适的图片进行替换。

\subsection{自定义封面}

另外，如果使用自定义的封面，比如 Adobe illustrator 或者其他软件制作的 A4 PDF 文档，请把 \lstinline{\maketitle} 注释掉，然后借助 \lstinline{pdfpages} 宏包将自制封面插入即可。如果使用 \lstinline{titlepage} 环境，也是类似。如果需要 2.x 版本的封面，请参考 \href{https://github.com/EthanDeng/etitlepage}{etitlepage}。

\section{章标标题}

本模板内置 2 套\textit{章标题显示风格}，包含 \lstinline{hang}（默认）与 \lstinline{display} 两种风格，区别在于章标题单行显示（\lstinline{hang}）与双行显示（\lstinline{display}），本说明使用了 \lstinline{hang}。调用方式为
\begin{lstlisting}
\documentclass[hang]{elegantbook} %or
\documentclass[titlestyle=hang]{elegantbook}
\end{lstlisting}

在章标题内，章节编号默认是以数字显示，也即{\kaishu 第 1 章}，{\kaishu 第 2 章}等等，如果想要把数字改为中文，可以使用
\begin{lstlisting}
\documentclass[chinese]{elegantbook} %or
\documentclass[scheme=chinese]{elegantbook}
\end{lstlisting}

\section{数学环境简介}

在我们这个模板中，我们定义了两种不同的定理模式 \lstinline{mode}，包括简单模式（\lstinline{simple}）和炫彩模式（\lstinline{fancy}），默认为 \lstinline{fancy} 模式，不同模式的选择为
\begin{lstlisting}
\documentclass[simple]{elegantbook} %or
\documentclass[mode=simple]{elegantbook}
\end{lstlisting}

本模板定义了四大类环境

\begin{itemize}
  \item \textit{定理类环境}，包含标题和内容两部分，全部定理类环境的编号均以章节编号。根据格式的不同分为 3 种
    \begin{itemize}
      \item \textcolor{main}{\textbf{definition}} 环境，颜色为 \textcolor{main}{main}；
      \item \textcolor{second}{\textbf{theorem、lemma、corollary、axiom、postulate}} 环境，颜色为 \textcolor{second} {second}；
      \item \textcolor{third}{\textbf{proposition}} 环境，颜色为 \textcolor{third}{third}。
    \end{itemize}
  \item \textit{示例类环境}，有 \textbf{example、problem、exercise} 环境（对应于例、例题、练习），自动编号，编号以章节为单位，其中 \textbf{exercise} 有提示符。
  \item \textit{提示类环境}，有 \textbf{note} 环境，特点是：无编号，有引导符。
  \item \textit{结论类环境}，有 \textbf{conclusion、assumption、property、remark、solution} 环境\footnote{本模板还添加了一个 \lstinline|result| 选项，用于隐藏 \lstinline{solution} 和 \lstinline{proof} 环境，默认为显示（\lstinline{result=answer}），隐藏使用 \lstinline{result=noanswer}。}，三者均以粗体的引导词为开头，和普通段落格式一致。
\end{itemize}

其中，定理类环境均有带星号的版本：\textcolor{main}{\textbf{definition*}}、\textcolor{second}{\textbf{theorem*}}、\textcolor{second}{\textbf{lemma*}}、\textcolor{second}{\textbf{corollary*}}、\textcolor{second}{\textbf{axiom*}}、\textcolor{second}{\textbf{postulate*}}、\textcolor{third}{\textbf{proposition*}}，带星号的定理类环境不会编号。

\subsection{定理类环境的使用}

\subsubsection{\texttt{fancy} 模式}

在 \lstinline{fancy} 模式下使用了 \lstinline{tcolorbox} 宏包来定制定理类环境，所以和普通的定理环境的使用有些许区别，有编号定理的使用方法如下：

\begin{lstlisting}
% 有名字，有标签
\begin{theorem}{theorem name}{label}
  这是一个有名字和标签的定理。
  用 \ref{thm:label} 来引用这个定理。
\end{theorem}
% 无名字，有标签
\begin{theorem}{}{label no name}
  这是一个没有名字但是有标签的定理。
  用 \ref{thm:label no name} 来引用这个定理。
\end{theorem}
% 有名字，无标签
\begin{theorem}{theorem name}{}
  这是一个有名字但是没有标签的定理。
  这个定理不能被引用。
  最后的 {} 可以省略不写。
\end{theorem}
% 无名字，无标签
\begin{theorem}{}{}
  这是一个没有名字也没有标签的定理。
  这个定理不能被引用。
  两个 {} 均可以省略不写。
\end{theorem}
\end{lstlisting}

第一个选项 \lstinline{theorem name} 是定理的名字，如果定理没有名字请使用 \lstinline|{}|\cprotect\footnote{除非这个定理也没有标签，否则不能省略。}。第二个选项 \lstinline{label} 是交叉引用时所用到的标签，如果定理没有标签，可以不写 \lstinline|{label}| 或使用 \lstinline|{}|。交叉引用的方法为 \lstinline|\ref{thm:label}|。请注意，交叉引用时必须加上前缀 \lstinline{thm:}。其他相同用法的定理类环境见表 \ref{tab:theorem-class}。

不编号的定理使用方法如下：

\begin{lstlisting}
% 有名字
\begin{theorem*}{theorem name}
  这是一个不编号的有名字的定理。
  这个定理不能被引用。
\end{theorem*}
% 无名字
\begin{theorem*}{}
  这是一个不编号且没有名字的定理。
  最后的 {} 可以省略不写。
  这个定理不能被引用。
\end{theorem*}
\end{lstlisting}
其中的选项 \lstinline{theorem name} 是定理的名字，如果没有名字可以不写 \lstinline|{theorem name}| 或使用 \lstinline|{}|

\begin{table}[htbp]
  \centering
  \caption{定理类环境}
    \begin{tabular}{llll}
    \toprule
    环境名 & 标签名 & 前缀 & 交叉引用 \\
    \midrule
    definition & label & def   & \lstinline|\ref{def:label}| \\
    theorem & label & thm   & \lstinline|\ref{thm:label}| \\
    postulate & label & pos & \lstinline|\ref{pos:label}| \\
    axiom & label & axi & \lstinline|\ref{axi:label}|\\
    lemma & label & lem   & \lstinline|\ref{lem:label}| \\
    corollary & label & cor   & \lstinline|\ref{cor:label}| \\
    proposition & label & pro   & \lstinline|\ref{pro:label}| \\
    \bottomrule
    \end{tabular}%
  \label{tab:theorem-class}%
\end{table}%

在用户多次反馈下，在 4.1 版本引入了原生定理的支持方式，使用方法如下：

\begin{lstlisting}
% 有名字，有标签
\begin{theorem}[theorem name]\label{thm:label}
  这是一个有名字和标签的定理。
  用 \ref{thm:label} 来引用这个定理。
\end{theorem}
% 无名字，有标签
\begin{theorem}\label{thm:label no name}
  这是一个没有名字但是有标签的定理。
  用 \ref{thm:label no name} 来引用这个定理。
\end{theorem}
% 有名字，无标签
\begin{theorem}[theorem name]
  这是一个有名字但是没有标签的定理。
  这个定理不能被引用。
\end{theorem}
% 无名字，无标签
\begin{theorem}
  这是一个没有名字也没有标签的定理。
  这个定理不能被引用。
\end{theorem}
\end{lstlisting}
这时引用不需要加前缀，\lstinline{\ref} 中的内容与 \lstinline{\label} 中的内容相同，换句话说，这时的使用方法与使用原生定理环境的时候几乎相同。

\subsubsection{\texttt{simple} 模式}

在 \lstinline{simple} 模式下使用了 \lstinline{amsthm} 宏包，定理类环境使用方法与原生一致，定理的使用方法如下：

\begin{lstlisting}
% 有名字，有标签
\begin{theorem}[theorem name]\label{thm:label}
  这是一个有名字和标签的定理。
  用 \ref{thm:label} 来引用这个定理。
\end{theorem}
% 无名字，有标签
\begin{theorem}\label{thm:label no name}
  这是一个没有名字但是有标签的定理。
  用 \ref{thm:label no name} 来引用这个定理。
\end{theorem}
% 有名字，无标签
\begin{theorem}[theorem name]
  这是一个有名字但是没有标签的定理。
  这个定理不能被引用。
\end{theorem}
% 无名字，无标签
\begin{theorem}
  这是一个没有名字也没有标签的定理。
  这个定理不能被引用。
\end{theorem}
\end{lstlisting}

% \subsection{算法环境}

% \begin{algorithm}\label{alg:test}
%   \Input{A bitmap $I$ of size $w \times l$}
%   \Output{A partition of the bitmap}
%   \BlankLine
%   \emph{special treatment of the first line}\;
%   \For{$i \leftarrow 2$ \KwTo $l$}{
%     \emph{special treatment of the first element of line $i$}\;
%     \For{$j \leftarrow 2$ \KwTo $w$}{\label{forins}
%       $\Left \leftarrow \FindCompress{$I[i,j-1]$}$\;
%       $\Up \leftarrow \FindCompress{$I[i-1,]$}$\;
%       $\This \leftarrow \FindCompress{$I[i,j]$}$\;
%       \If(\tcp*[h]{O(\Left,\This)==1}){\Left compatible with \This}{\label{lt}
%         \lIf{$\Left < \This$}{$\Union{\Left,\This}$}
%         \lElse{$\Union{\This,\Left}$}
%       }
%       \If(\tcp*[f]{O(\Up,\This)==1}){\Up compatible with \This}{\label{ut}
%         \lIf{$\Up < \This$}{$\Union{\Up,\This}$}
%         \tcp{\This is put under \Up to keep tree as flat as possible}\label{cmt}
%         \lElse{$\Union{\This,\Up}$}\tcp*[r]{\This{} linked to \Up}\label{lelse}
%       }
%     }
%     \lForEach{element $e$ of the line $i$}{\FindCompress{p}}
%   }
%   \caption{disjoint decomposition}\label{algo_disjdecomp}
% \end{algorithm}


\subsection{修改计数器}

当前定理等环境计数器按章计数，如果想修改定理类环境按节计数，可以修改计数器选项 \lstinline{thmcnt}，可用选项为 \lstinline{chapter} （默认）与 \lstinline{section}：

\begin{lstlisting}
\documentclass[section]{elegantbook} %or
\documentclass[thmcnt=section]{elegantbook}
\end{lstlisting}

如果希望全局的定理类环境使用同一个计数器，可以使用文档类选项 \lstinline{usesamecnt}：

\begin{lstlisting}
  \documentclass[usesamecnt]{elegantbook}
\end{lstlisting}

\subsection{自定义定理类环境}

4.4 版本新增了一个自定义定理类环境的命令：\lstinline|\elegantnewtheorem|，它的参数含义如下：

\begin{lstlisting}
% fancy 模式（默认）
\elegantnewtheorem{env}{title}{style}{prefix}[numbered-like]
% simple 模式
\elegantnewtheorem{env}{title}{style}[numbered-like]
\end{lstlisting}
该命令可以同时定义编号环境 \lstinline|env| 和不编号环境 \lstinline|env*|。

其中 \lstinline|style| 支持的参数有：\lstinline|defstyle|，\lstinline|thmstyle|，\lstinline|prostyle|，分别对应“定义”，“定理”，“命题”三种样式。

如果添加了可选参数 \lstinline{numbered-like}，将会使该定理类环境与名为 \lstinline{numbered-like} 的定理类环境使用同一计数器。\textbf{注意}：该参数在使用 \lstinline{usesamecnt} 选项时不起作用，并且会在终端以及 \lstinline{.log} 文件中输出一个警告，来提示用户该选项不起作用：

\begin{lstlisting}
  [numbered-like] won't make sence with option
  `usesamecnt'.
\end{lstlisting}

\begin{itemize}
  \item 在炫彩模式（\lstinline{fancy}）下，需要 5 个参数来定义一个新的定理类环境，分别是：
  定理类环境名，定理类环境的标题，定理类环境的样式，该定理类环境的前缀，（可选）该定理类环境继承的定理类环境：

\begin{lstlisting}
% 导言区
\elegantnewtheorem{examplefancy}{自定义定理类环境}{thmstyle}{exfancy}
% 正文
\begin{examplefancy}{定理名}{label}
  这里是自定义定理类环境 \ref{exfancy:label}
\end{examplefancy}
\begin{examplefancy*}{定理名}
  这里是无编号自定义定理类环境
\end{examplefancy*}
\end{lstlisting}

  如果不给出第四个参数，或第四个参数置空的话，将会用定理类环境名来作为默认前缀，即
\begin{lstlisting}
% 导言区
\elegantnewtheorem{test}{TEST}{thmstyle}
% 或
\elegantnewtheorem{test}{TEST}{thmstyle}{}
% 正文
\begin{test}{name}{label}
  默认前缀为 test。
  使用 \ref{test:label} 来引用这个定理类环境。
\end{test}
\end{lstlisting}

这时会在终端以及 \verb|.log| 文件中输出一个警告信息来提示用户没有定义前缀：

\begin{lstlisting}[language=bash]
Class elegantbook Warning: Because you didn't provide a prefix. 
(elegantbook)              We use test as the default prefix. 
(elegantbook)              You have to use 
(elegantbook)              \ref {test:label} to refer a 
(elegantbook)              \begin {test}{name}{label} environment. 
(elegantbook)               on input line 3.
\end{lstlisting}

  \item 在简单模式（\lstinline{simple}）下，需要 4 个参数来定义一个新的定理类环境，分别是：
  定理类环境名，定理类环境的标题，定理类环境的样式，该定理类环境的前缀，（可选）该定理类环境继承的定理类环境：
\begin{lstlisting}
% 导言区
\elegantnewtheorem{examplesimple}{自定义定理类环境}{thmstyle}
% 正文
\begin{examplesimple}[定理名]\label{exsimple:label}
  这里是自定义定理类环境 \ref{exsimple:label}
\end{examplesimple}
\begin{examplesimple*}[定理名]
  这里是无编号自定义定理类环境
\end{examplesimple*}
\end{lstlisting}

  如果此时错误地给出了第四个参数，那么将会在终端以及 \verb|.log| 文件中输出一个错误信息：
\begin{lstlisting}
% elegantbook-cn.tex
\elegantnewtheorem{test}{TEST}{thmstyle}{}
% .log file
./elegantbook-cn.tex:3: Class elegantbook Error: You can't set a prefix in mode ``simple''.
(elegantbook)              Just use 
(elegantbook)              \elegantnewtheorem {test}{TEST}{thmstyle} .
\end{lstlisting}

\end{itemize}

\subsection{其他环境的使用}

其他三种环境没有选项，可以直接使用，比如 \lstinline{example} 环境的使用方法与效果：
\begin{lstlisting}
\begin{example}
   This is the content of example environment.
\end{example}
\end{lstlisting}

这几个都是同一类环境，区别在于

\begin{itemize}
  \item 示例环境（example）、练习（exercise）与例题（problem）章节自动编号；
  \item 注意（note），练习（exercise）环境有提醒引导符；
  \item 结论（conclusion）等环境都是普通段落环境，引导词加粗。
\end{itemize}

\section{列表环境}
本模板借助于 \lstinline{tikz} 定制了 \lstinline{itemize} 和 \lstinline{enumerate} 环境，其中 \lstinline{itemize} 环境修改了 3 层嵌套，而 \lstinline{enumerate} 环境修改了 4 层嵌套（仅改变颜色）。示例如下\\[2ex]
\begin{minipage}[b]{0.49\textwidth}
  \begin{itemize}
    \item first item of nesti;
    \item second item of nesti;
      \begin{itemize}
        \item first item of nestii;
        \item second item of nestii;
        \begin{itemize}
          \item first item of nestiii;
          \item second item of nestiii.
        \end{itemize}   
      \end{itemize}
  \end{itemize}
\end{minipage}
\begin{minipage}[b]{0.49\textwidth}
  \begin{enumerate}
    \item first item of nesti;
    \item second item of nesti;
      \begin{enumerate}
        \item first item of nestii;
        \item second item of nestii;
        \begin{enumerate}
          \item first item of nestiii;
          \item second item of nestiii.
        \end{enumerate}   
      \end{enumerate}
  \end{enumerate}
\end{minipage}

\section{参考文献}

\subsection{打印文献}

之前我们将文献调用的命令放在模板里面，然后用户反馈 \lstinline{\cite} 命令无法自动补全，因此我们新版本将其拿到外面来，新版本打印参考文献的命令的方法是，在导言区（也即 \lstinline|\begin{document}| 之前），加入：

\begin{lstlisting}
  \addbibresource[location=local]{reference.bib}
\end{lstlisting}

然后再需要打印文献的地方使用：
\begin{lstlisting}
  \printbibliography[heading=bibintoc, title=\ebibname]
\end{lstlisting}

其中 \lstinline{reference.bib} 为参考文献存放的文件，需要放在项目文件夹下。

\subsection{修改文献格式}

此外，本模板调用了 biblatex 宏包，并提供了 biber（默认） 和 bibtex 两个后端选项，可以使用 \lstinline{bibend} 进行修改：

\begin{lstlisting}
  \documentclass[bibtex]{elegantbook}
  \documentclass[bibend=bibtex]{elegantbook}
\end{lstlisting}

关于文献条目（bib item），你可以在谷歌学术，Mendeley，Endnote 中取，然后把它们添加到 \lstinline{reference.bib} 中。在文中引用的时候，引用它们的键值（bib key）即可。

为了方便文献样式修改，模板引入了 \lstinline{bibstyle} 和 \lstinline{citestyle} 选项，默认均为数字格式（numeric），参考文献示例：\cite{cn1,en2,en3} 使用了中国一个大型的 P2P 平台（人人贷）的数据来检验男性投资者和女性投资者在投资表现上是否有显著差异。

如果需要设置为国标 GB7714-2015，需要使用：
\begin{lstlisting}
  \documentclass[citestyle=gb7714-2015, bibstyle=gb7714-2015]{elegantbook} 
\end{lstlisting}

在使用
\begin{lstlisting}
  \documentclass[citestyle=gb7714-2015, bibstyle=gb7714-2015]{elegantbook} 
\end{lstlisting}
后，排序方式为按引用先后排序。如果不使用国标 GB7714-2015 并且需要添加排序方式，可以在导言区加入下面命令：
\begin{lstlisting}
  \ExecuteBibliographyOptions{sorting=<name>}
\end{lstlisting}
其中 \lstinline{<name>} 可以是 nty, nyt, nyvt, anyt, anyvt, ynt, ydnt, none, count, debug 的其中之一，更多排序相关请参考 biblatex 宏包手册的 3.1.2.1 节。


\section{添加序章}

如果你想在第一章前面添序章，不改变原本章节序号，可以在第一章内容前面使用 
\begin{lstlisting}
\chapter*{Introduction}
\markboth{Introduction}{Introduction}
The content of introduction.
\end{lstlisting}

\section{目录选项与深度}
本模板添加了一个目录选项 \lstinline{toc}，可以设置目录为单栏（\lstinline{onecol}）和双栏（\lstinline{twocol}）显示，比如双栏显示可以使用
\begin{lstlisting}
\documentclass[twocol]{elegantbook}
\documentclass[toc=twocol]{elegantbook}
\end{lstlisting}

默认本模板目录深度为 1，你可以在导言区使用
\begin{lstlisting}
\setcounter{tocdepth}{2}
\end{lstlisting}
将其修改为 2 级目录（章与节）显示。


\section{章节摘要}
模板新增了一个章节摘要环境（introduction），使用示例
\begin{lstlisting}
\begin{introduction}
  \item Definition of Theorem
  \item Ask for help
  \item Optimization Problem
  \item Property of Cauchy Series
  \item Angle of Corner
\end{introduction}
\end{lstlisting}
效果如下：
\begin{introduction}
  \item Definition of Theorem
  \item Ask for help
  \item Optimization Problem
  \item Property of Cauchy Series
  \item Angle of Corner
\end{introduction}

环境的标题文字可以通过这个环境的可选参数进行修改，修改方法为：
\begin{lstlisting}
\begin{introduction}[Brief Introduction]
...
\end{introduction}
\end{lstlisting}

\section{章后习题}
前面我们介绍了例题和练习两个环境，这里我们再加一个，章后习题（\lstinline{problemset}）环境，用于在每一章结尾，显示本章的练习。使用方法如下

\begin{lstlisting}
\begin{problemset}
  \item exercise 1
  \item exercise 2
  \item exercise 3
\end{problemset}
\end{lstlisting}


效果如下：
\begin{problemset}[我的题目]
  \item exercise 1
  \item exercise 2
  \item exercise 3
  \item 测试数学公式
  \begin{equation}
    a^2+b^2=c_{2_{i}} (1,2) [1,23]
  \end{equation}
\end{problemset}

\begin{remark}
如果你想把 \lstinline{problemset} 环境的标题改为其他文字，你可以类似于 introduction 环境修改 problemset 的可选参数。另外，目前这个环境会自动出现在目录中，但是不会出现在页眉页脚信息中（待解决）。
\end{remark}

\begin{solution}
如果你想把 \lstinline{problemset} 环境的标题改为其他文字，你可以类似于 introduction 环境修改 problemset 的可选参数。另外，目前这个环境会自动出现在目录中，但是不会出现在页眉页脚信息中（待解决）。
\end{solution}

\section{旁注}

在 3.08 版本中，我们引入了 旁注设置选项 \lstinline{marginpar=margintrue} 以及测试命令 \lstinline{\elegantpar} ，但是由此带来一堆问题。我们决定在 3.09 版本中将其删除，并且，在旁注命令得到大幅度优化之前，不会将此命令再次引入书籍模板中。对此造成各位用户的不方便，非常抱歉！不过我们保留了 \lstinline{marginpar} 这个选项，你可以使用 \lstinline{marginpar=margintrue} 获得保留右侧旁注的版面设计。然后使用系统自带的 \lstinline{\marginpar} 或者 \lstinline{marginnote} 宏包的 \lstinline{\marginnote} 命令。

\begin{remark}
在使用旁注的时候，需要注意的是，文本和公式可以直接在旁注中使用。

\begin{lstlisting}
% text
\marginpar{margin paragraph text}

% equation
\marginpar{
  \begin{equation}
    a^2 + b^2 = c^2
  \end{equation}
}
\end{lstlisting}

但是浮动体（表格、图片）需要注意，不能用浮动体环境，需要使用直接插图命令或者表格命令环境。然后使用 \lstinline{\captionof} 为其设置标题。为了得到居中的图表，可以使用 \lstinline{\centerline} 命令或者 \lstinline{center} 环境。更多详情请参考：\href{https://tex.stackexchange.com/questions/5583/caption-of-figure-in-marginpar-and-caption-of-wrapfigure-in-margin}{Caption of Figure in Marginpar}。

\begin{lstlisting}
% graph with centerline command
\marginpar{
  \centerline{
    \includegraphics[width=0.2\textwidth]{logo.png}
  }
  \captionof{figure}{your figure caption}
}

% graph with center environment
\marginpar{
  \begin{center}
    \includegraphics[width=0.2\textwidth]{logo.png}
    \captionof{figure}{your figure caption}
  \end{center}
}
\end{lstlisting}

\end{remark}

\chapter{字体选项}
字体选项独立成章的原因是，我们希望本模板的用户关心模板使用的字体，知晓自己使用的字体以及遇到字体相关的问题能更加便捷地找到答案。

\textcolor{red}{\bfseries 重要提示}：从 3.10 版本更新之后，沿用至今的 newtx 系列字体被重新更改为 cm 字体。并且新增中文字体（\lstinline{chinesefont}）选项。

\section{数学字体选项}

本模板定义了一个数学字体选项（\lstinline{math}），可选项有三个：
\begin{enumerate}
  \item \lstinline{math=cm}（默认），使用 \LaTeX{} 默认数学字体（推荐，无需声明）；
  \item \lstinline{math=newtx}，使用 \lstinline{newtxmath} 设置数学字体（潜在问题比较多）。
  \item \lstinline{math=mtpro2}，使用 \lstinline{mtpro2} 宏包设置数学字体，要求用户已经成功安装此宏包。
\end{enumerate}

\section{使用 newtx 系列字体}

如果需要使用原先版本的 \lstinline{newtx} 系列字体，可以通过显示声明数学字体：

\begin{lstlisting}
\documentclass[math=newtx]{elegantbook}
\end{lstlisting}

\subsection{连字符}

如果使用 \lstinline{newtx} 系列字体宏包，需要注意下连字符的问题。
\begin{equation}
  \int_{R^q} f(x,y) dy.\emph{of\kern0pt f} \sin x
\end{equation}
的代码为
\begin{lstlisting}
\begin{equation}
  \int_{R^q} f(x,y) dy.\emph{of\kern0pt f} \sin x
\end{equation}
\end{lstlisting}

\subsection{宏包冲突}

另外在 3.08 版本中，有用户反馈模板在和 \lstinline{yhmath} 以及 \lstinline{esvect} 等宏包搭配使用的时候会出现报错：
\begin{lstlisting}
LaTeX Error:
   Too many symbol fonts declared.
\end{lstlisting}

原因是在使用 \lstinline{newtxmath} 宏包时，重新定义了数学字体用于大型操作符，达到了 {\heiti 最多 16 个数学字体} 的上限，在调用其他宏包的时候，无法新增数学字体。为了减少调用非常用宏包，在此给出如何调用 \lstinline{yhmath} 以及 \lstinline{esvect} 宏包的方法。

请在 \lstinline{elegantbook.cls} 内搜索 \lstinline{yhmath} 或者 \lstinline{esvect}，将你所需要的宏包加载语句\textit{取消注释}即可。
\begin{lstlisting}
%%% use yhmath pkg, uncomment following code
% \let\oldwidering\widering
% \let\widering\undefined
% \RequirePackage{yhmath}
% \let\widering\oldwidering

%%% use esvect pkg, uncomment following code
% \RequirePackage{esvect}
\end{lstlisting}

\section{中文字体选项}
模板从 3.10 版本提供中文字体选项 \lstinline{chinesefont}，可选项有
\begin{enumerate}
\item \lstinline{ctexfont}：默认选项，使用 \lstinline{ctex} 宏包根据系统自行选择字体，可能存在字体缺失的问题，更多内容参考 \lstinline{ctex} 宏包\href{https://ctan.org/pkg/ctex}{官方文档}\footnote{可以使用命令提示符，输入 \lstinline{texdoc ctex} 调出本地 \lstinline{ctex} 宏包文档}。
\item \lstinline{founder}：方正字体选项（\textbf{需要安装方正字体}），后台调用 \lstinline{ctex} 宏包并且使用 \lstinline{fontset=none} 选项，然后设置字体为方正四款免费字体，方正字体下载注意事项见后文，用户只需要安装方正字体即可使用该选项。
\item \lstinline{nofont}：后台会调用 \lstinline{ctex} 宏包并且使用 \lstinline{fontset=none} 选项，不设定中文字体，用户可以自行设置中文字体，具体见后文。
\end{enumerate}

\subsection{方正字体选项}
由于使用 \lstinline{ctex} 宏包默认调用系统已有的字体，部分系统字体缺失严重，因此，用户希望能够使用其它字体，我们推荐使用方正字体。方正的{\songti 方正书宋}、{\heiti 方正黑体}、{\kaishu 方正楷体}、{\fangsong 方正仿宋}四款字体均可免费试用，且可用于商业用途。用户可以自行从\href{http://www.foundertype.com/}{方正字体官网}下载此四款字体，在下载的时候请\textbf{务必}注意选择 GBK 字符集，也可以使用 \href{https://www.latexstudio.net/}{\LaTeX{} 工作室}提供的\href{https://pan.baidu.com/s/1BgbQM7LoinY7m8yeP25Y7Q}{方正字体，提取码为：njy9} 进行安装。安装时，{\kaishu Win 10 用户请右键选择为全部用户安装，否则会找不到字体。}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.9\textwidth]{founder.png}
\end{figure}

\subsection{其他中文字体}
如果你想完全自定义字体\footnote{这里仍然以方正字体为例。}，你可以选择 \lstinline{chinesefont=nofont}，然后在导言区设置
\begin{lstlisting}
\setCJKmainfont[BoldFont={FZHei-B01},ItalicFont={FZKai-Z03}]{FZShuSong-Z01}
\setCJKsansfont[BoldFont={FZHei-B01}]{FZKai-Z03}
\setCJKmonofont[BoldFont={FZHei-B01}]{FZFangSong-Z02}
\setCJKfamilyfont{zhsong}{FZShuSong-Z01}
\setCJKfamilyfont{zhhei}{FZHei-B01}
\setCJKfamilyfont{zhkai}[BoldFont={FZHei-B01}]{FZKai-Z03}
\setCJKfamilyfont{zhfs}[BoldFont={FZHei-B01}]{FZFangSong-Z02}
\newcommand*{\songti}{\CJKfamily{zhsong}}
\newcommand*{\heiti}{\CJKfamily{zhhei}}
\newcommand*{\kaishu}{\CJKfamily{zhkai}}
\newcommand*{\fangsong}{\CJKfamily{zhfs}}
\end{lstlisting}

\chapter{ElegantBook 写作示例}

\begin{introduction}
  \item 积分定义~\ref{def:int}
  \item Fubini 定理~\ref{thm:fubi}
  \item 最优性原理~\ref{pro:max}
  \item 柯西列性质~\ref{property:cauchy}
  \item 韦达定理
\end{introduction}

\section{Lebesgue 积分}
在前面各章做了必要的准备后，本章开始介绍新的积分。在 Lebesgue 测度理论的基础上建立了 Lebesgue 积分，其被积函数和积分域更一般，可以对有界函数和无界函数统一处理。正是由于 Lebesgue 积分的这些特点，使得 Lebesgue 积分比 Riemann 积分具有在更一般条件下的极限定理和累次积分交换积分顺序的定理，这使得 Lebesgue 积分不仅在理论上更完善，而且在计算上更灵活有效。

Lebesgue 积分有几种不同的定义方式。我们将采用逐步定义非负简单函数，非负可测函数和一般可测函数积分的方式。

由于现代数学的许多分支如概率论、泛函分析、调和分析等常常用到一般空间上的测度与积分理论，在本章最后一节将介绍一般的测度空间上的积分。

\subsection{积分的定义}

我们将通过三个步骤定义可测函数的积分。首先定义非负简单函数的积分。以下设 $E$ 是 $\mathcal{R}^n$ 中的可测集。

\begin{definition}[可积性] \label{def:int} 
设 $ f(x)=\sum\limits_{i=1}^{k} a_i \chi_{A_i}(x)$ 是 $E$ 上的\textbf{非负简单函数}，中文其中 $\{A_1,A_2,\ldots,A_k\}$ 是 $E$ 上的一个可测分割，$a_1,a_2,\ldots,a_k$ 是非负实数。定义 $f$ 在 $E$ 上的积分为 $\int_{a}^b f(x)$
\begin{equation}
   \label{inter}
   \int_{E} f dx = \sum_{i=1}^k a_i m(A_i) \pi \alpha\beta\sigma\gamma\nu\xi\epsilon\varepsilon. \oint_{a}^b\ointop_{a}^b\prod_{i=1}^n
\end{equation}
一般情况下 $0 \leq \int_{E} f dx \leq \infty$。若 $\int_{E} f dx < \infty$，则称 $f$ 在 $E$ 上可积。
\end{definition}

一个自然的问题是，Lebesgue 积分与我们所熟悉的 Riemann 积分有什么联系和区别？在 4.4 在我们将详细讨论 Riemann 积分与 Lebesgue 积分的关系。这里只看一个简单的例子。设 $D(x)$ 是区间 $[0,1]$ 上的 Dirichlet 函数。即 $D(x)=\chi_{Q_0}(x)$，其中 $Q_0$ 表示 $[0,1]$ 中的有理数的全体。根据非负简单函数积分的定义，$D(x)$ 在 $[0,1]$ 上的 Lebesgue 积分为
\begin{equation}
   \label{inter2}
   \int_0^1 D(x)dx = \int_0^1 \chi_{Q_0} (x) dx = m(Q_0) = 0
\end{equation}
即 $D(x)$ 在 $[0,1]$ 上是 Lebesgue 可积的并且积分值为零。但 $D(x)$ 在 $[0,1]$ 上不是 Riemann 可积的。


有界变差函数是与单调函数有密切联系的一类函数。有界变差函数可以表示为两个单调递增函数之差。与单调函数一样，有界变差函数几乎处处可导。与单调函数不同，有界变差函数类对线性运算是封闭的，它们构成一线空间。练习题 \ref{exer:43} 是一个性质的证明。

\begin{exercise}\label{exer:43}
设 $f \notin\in L(\mathcal{R}^1)$，$g$ 是 $\mathcal{R}^1$ 上的有界可测函数。证明函数
\begin{equation}
   \label{ex:1}
   I(t) = \int_{\mathcal{R}^1} f(x+t)g(x)dx \quad t \in \mathcal{R}^1
\end{equation}
是 $\mathcal{R}^1$ 上的连续函数。 
\end{exercise}

\begin{solution}
即 $D(x)$ 在 $[0,1]$ 上是 Lebesgue 可积的并且积分值为零。但 $D(x)$ 在 $[0,1]$ 上不是 Riemann 可积的。
\end{solution}

\begin{proof}
即 $D(x)$ 在 $[0,1]$ 上是 Lebesgue 可积的并且积分值为零。但 $D(x)$ 在 $[0,1]$ 上不是 Riemann 可积的。
\end{proof}

\begin{theorem}[Fubini 定理] \label{thm:fubi} 
（1）若 $f(x,y)$ 是 $\mathcal{R}^p\times\mathcal{R}^q$ 上的非负可测函数，则对几乎处处的 $x\in \mathcal{R}^p$，$f(x,y)$ 作为 $y$ 的函数是 $\mathcal{R}^q$ 上的非负可测函数，$g(x)=\int_{\mathcal{R}^q}f(x,y) dy$ 是 $\mathcal{R}^p$ 上的非负可测函数。并且
\begin{equation}
   \label{eq:461}
   \int_{\mathcal{R}^p\times\mathcal{R}^q} f(x,y) dxdy=\int_{\mathcal{R}^p}\left(\int_{\mathcal{R}^q}f(x,y)dy\right)dx.
\end{equation}

（2）若 $f(x,y)$ 是 $\mathcal{R}^p\times\mathcal{R}^q$ 上的可积函数，则对几乎处处的 $x\in\mathcal{R}^p$，$f(x,y)$ 作为 $y$ 的函数是 $\mathcal{R}^q$ 上的可积函数，并且 $g(x)=\int_{\mathcal{R}^q}f(x,y) dy$ 是 $\mathcal{R}^p$ 上的可积函数。而且~\eqref{eq:461} 成立。
\end{theorem}

\begin{note}
在本模板中，引理（lemma），推论（corollary）的样式和定理~\ref{thm:fubi} 的样式一致，包括颜色，仅仅只有计数器的设置不一样。
\end{note}

我们说一个实变或者复变量的实值或者复值函数是在区间上平方可积的，如果其绝对值的平方在该区间上的积分是有限的。所有在勒贝格积分意义下平方可积的可测函数构成一个希尔伯特空间，也就是所谓的 $L^2$ 空间，几乎处处相等的函数归为同一等价类。形式上，$L^2$ 是平方可积函数的空间和几乎处处为 0 的函数空间的商空间。

\begin{proposition}[最优性原理] \label{pro:max}
如果 $u^*$ 在 $[s,T]$ 上为最优解，则 $u^*$ 在 $[s, T]$ 任意子区间都是最优解，假设区间为 $[t_0, t_1]$ 的最优解为 $u^*$ ，则 $u(t_0)=u^{*}(t_0)$，即初始条件必须还是在 $u^*$ 上。
\end{proposition}

我们知道最小二乘法可以用来处理一组数据，可以从一组测定的数据中寻求变量之间的依赖关系，这种函数关系称为经验公式。本课题将介绍最小二乘法的精确定义及如何寻求点与点之间近似成线性关系时的经验公式。假定实验测得变量之间的 $n$ 个数据，则在平面上，可以得到 $n$ 个点，这种图形称为 “散点图”，从图中可以粗略看出这些点大致散落在某直线近旁, 我们认为其近似为一线性函数，下面介绍求解步骤。

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.6\textwidth]{scatter.jpg}
  \caption{散点图示例 $\hat{y}=a+bx$ \label{fig:scatter}}
\end{figure}

以最简单的一元线性模型来解释最小二乘法。什么是一元线性模型呢？监督学习中，如果预测的变量是离散的，我们称其为分类（如决策树，支持向量机等），如果预测的变量是连续的，我们称其为回归。回归分析中，如果只包括一个自变量和一个因变量，且二者的关系可用一条直线近似表示，这种回归分析称为一元线性回归分析。如果回归分析中包括两个或两个以上的自变量，且因变量和自变量之间是线性关系，则称为多元线性回归分析。对于二维空间线性是一条直线；对于三维空间线性是一个平面，对于多维空间线性是一个超平面。

\begin{property}\label{property:cauchy}
柯西列的性质
\begin{enumerate}
\item $\{x_k\}$ 是柯西列，则其子列 $\{x_k^i\}$ 也是柯西列。
\item $x_k\in \mathcal{R}^n$，$\rho(x,y)$ 是欧几里得空间，则柯西列收敛，$(\mathcal{R}^n,\rho)$ 空间是完备的。
\end{enumerate}
\end{property}

\begin{conclusion}
回归分析（regression analysis） 是确定两种或两种以上变量间相互依赖的定量关系的一种统计分析方法。运用十分广泛，回归分析按照涉及的变量的多少，分为一元回归和多元回归分析；按照因变量的多少，可分为简单回归分析和多重回归分析；按照自变量和因变量之间的关系类型，可分为线性回归分析和非线性回归分析。
\end{conclusion}

\begin{problemset}
\item 设 $A$ 为数域 $K$ 上的 $n$ 级矩阵。证明：如果 $K^n$ 中任意非零列向量都是 $A$ 的特征向量，则 $A$ 一定是数量矩阵。
\item 证明：不为零矩阵的幂零矩阵不能对角化。
\item 设 $A = (a_{ij})$ 是数域 $K$ 上的一个 $n$ 级上三角矩阵，证明：如果 $a_{11} = a_{22} = \cdots = a_{nn}$，并且至少有一个 $a_{kl} \not = 0 (k < l)$，则 $A$ 一定不能对角化。
\end{problemset}

\chapter{常见问题集}

我们根据用户社区反馈整理了下面一些常见的问题，用户在遇到问题时，应当首先查阅本手册和本部分的常见的问题。

\begin{enumerate}[itemsep=1.5ex]
  \item \question{有没有办法章节用“第一章，第一节，（一）”这种？}
    见前文介绍，可以使用 \lstinline{scheme=chinese} 设置。
  \item \question{大佬，我想把正文字体改为亮色，背景色改为黑灰色。}
    页面颜色可以使用 \lstinline{\pagecolor} 命令设置，文本命令可以参考\href{https://tex.stackexchange.com/questions/278544/xcolor-what-is-the-equivalent-of-default-text-color}{这里}进行设置。
  \item \question{\lstinline{! LaTeX Error: Unknown option 'scheme=plain' for package 'ctex'.}}
    你用的 C\TeX{} 套装吧？这个里面的 \lstinline{ctex} 宏包已经是已经是 10 年前的了，与本模板使用的 \lstinline{ctex} 宏集有很大区别。不建议 C\TeX{} 套装了，请卸载并安装 \TeX{} Live 2022。
  \item \question{我该使用什么版本？}
    请务必使用\href{https://github.com/ElegantLaTeX/ElegantBook/releases}{最新正式发行版}，发行版间不定期可能会有更新（修复 bug 或者改进之类），如果你在使用过程中没有遇到问题，不需要每次更新\href{https://github.com/ElegantLaTeX/ElegantBook/archive/master.zip}{最新版}，但是在发行版更新之后，请尽可能使用最新版（发行版）！最新发行版可以在 GitHub 或者 \TeX{} Live 2021 内获取。
  \item \question{我该使用什么编辑器？}
    你可以使用 \TeX{} Live 2021 自带的编辑器 \TeX{}works 或者使用 \TeX{}studio，\TeX works 的自动补全，你可以参考我们的总结 \href{https://github.com/EthanDeng/texworks-autocomplete}{\TeX works 自动补全}。推荐使用 \TeX{} Live 2021 + \TeX{}studio。我自己用 VS Code 和 Sublime Text，相关的配置说明，请参考 \href{https://github.com/EthanDeng/vscode-latex}{\LaTeX{} 编译环境配置：Visual Studio Code 配置简介} 和 \href{https://github.com/EthanDeng/sublime-text-latex}{Sublime Text 搭建 \LaTeX{} 编写环境}。
  \item \question{您好，我们想用您的 ElegantBook 模板写一本书。关于机器学习的教材，希望获得您的授权，谢谢您的宝贵时间。}
    模板的使用修改都是自由的，你们声明模板来源以及模板地址（GitHub 地址）即可，其他未尽事宜按照开源协议 LPPL-1.3c。做好之后，如果方便的话，可以给我们一个链接，我把你们的教材放在 Elegant\LaTeX{} 用户作品集里。
  \item \question{请问交叉引用是什么？}
    本群和本模板适合有一定 \LaTeX{} 基础的用户使用，新手请先学习 \LaTeX{} 的基础，理解各种概念，否则你将寸步难行。
  \item \question{代码高亮环境能用其他语言吗？}
    可以的，ElegantBook 模板用的是 \lstinline{listings} 宏包，你可以在环境（\lstinline{lstlisting}）之后加上语言（比如 Python 使用 \lstinline{language=Python} 选项），全局语言修改请使用 \lstinline{lstset} 命令，更多信息请参考宏包文档。
  \item \question{群主，什么时候出 Beamer 的模板（主题），ElegantSlide 或者 ElegantBeamer？}
    由于 Beamer 中有一个很优秀的主题 \href{https://github.com/matze/mtheme}{Metropolis}。后续确定不会再出任何主题/模板，请大家根据需要修改已有主题。
\end{enumerate}

\chapter{版本更新历史}

根据用户的反馈，我们不断修正和完善模板。由于 3.00 之前版本与现在版本差异非常大，在此不列出 3.00 之前的更新内容。

\datechange{2022/12/31}{版本 4.5} \textcolor{red}{\bfseries 停止维护！}

\datechange{2022/08/17}{版本 4.5 pre}
\begin{change}
  \item \textbf{重要改动}：提供了一个新的文档类选项 \lstinline|usesamecnt|，可以使全局的定理类环境使用同一个计数器。
  \item \textbf{重要改动}：修改了 \lstinline|\elegantnewtheorem| 命令，使其有第五个（可选）参数。
\end{change}

\datechange{2022/08/15}{版本 4.4 正式发布。}

\begin{change}
  \item \textbf{重要改动}：提供了一个定义定理类环境的命令 \lstinline|\elegantnewtheorem|；
  \item \textbf{重要改动}：为所有内置定理类环境提供了带星号的版本，带星号的定理类环境不会编号，修复 \href{https://github.com/ElegantLaTeX/ElegantBook/issues/167}{issue: \#167}；
  \item \textbf{重要改动}：在 \lstinline{scheme=chinese} 下将目录中的“第 1 章”修改为“第一章”；
  \item 将 TeX Gyre Termes 改为 TeX Gyre TermesX，使英文部分字形与 newtx 系列宏包更相近；
  \item 重写了内置定理类环境的实现方法，修复了一些 bug，由于修改部分较大，如果引入了新的 bug，请及时在 QQ 群或 \href{https://github.com/ElegantLaTeX}{Github} 上进行反馈；
  \item 删除 Gitee 仓库地址，恢复 GitHub 提交（pull requests）；
  \item 将参考文献命令添加到导言区，使编辑器能够对参考文献自动补全。
\end{change}

\datechange{2022/04/09}{版本 4.3 正式发布。}

\begin{change}
  \item 放弃 newtx 系列宏包的设置，改用 TeX Gyre Termes，并设置其他字体；
  \item 修改定理类环境内部字体设置，修复环境内部中文无法加粗问题；
  \item 增加定理类环境的计数器选项 \lstinline{thmcnt}，可选 \lstinline{chapter} 和 \lstinline{section}；
  \item 增加 \lstinline{bibend} 选项，可选 \lstinline{bibend=biber}（默认）和 \lstinline{bibend=bibtex}。
\end{change}



\datechange{2022/03/08}{版本 4.2 正式发布。}

\begin{change}
  \item 对于 newtx 系列宏包更新导致的字体 bug 的修复；
  \item 修缮目录格式，为了达到这个目的，重新改写 \lstinline{\chaptername} 的重定义语句；
  \item 增加日语 \lstinline{lang=jp} 设定。
  \item 这个版本为一个临时性版本，在 \TeX Live 2022 发布之后，将尽快发布 4.3 版本，由于对于中文的改动比较大，可能会出现预期之外的 bug，有问题可以在 QQ 群或者 Github 反馈。
\end{change}


\datechange{2021/05/02}{版本 4.1 正式发布。}

\begin{change}
  \item \textbf{重要改动}：由原先的 \hologo{BibTeX} 改为 biblatex 编译方式（后端为 \lstinline{biber}），请注意两者之间的差异；
  \item \textbf{重要改进}：修改对于定理写法兼容方式，提高数学公式代码的兼容性；
  \item 页面设置改动，默认页面更宽；方便书写和阅读；
  \item 支持目录文字以及页码跳转；
  \item 不再维护 \hologo{pdfLaTeX} 中文支持方式，请务必使用 \hologo{XeLaTeX} 编译中文文稿。
  \item 增加多个语言选项，法语 \lstinline{lang=fr}、荷兰语 \lstinline{lang=nl}、匈牙利语 \lstinline{lang=hu}、西班牙语 \lstinline{lang=es}、蒙古语 \lstinline{lang=mn} 等。
\end{change}


\datechange{2020/04/12}{版本 3.11 正式发布，\textcolor{red}{此版本为 3.x 最后版本。}}

\begin{change}
  \item \textbf{重要修正}：修复因为 \lstinline{gbt7714} 宏包更新导致的 \lstinline{natbib option clash} 错误；
  \item 由于 \lstinline{pgfornament} 宏包未被 \TeX{} Live 2020 收录，因此删除 base 相关的内容；
  \item 修复部分环境的空格问题；
  \item 增加了意大利语言选项 \lstinline{lang=it}。
\end{change}


\datechange{2020/02/10}{版本 3.10 正式发布}

\begin{change}
  \item 增加数学字体选项 \lstinline{math}，可选项为 \lstinline{newtx} 和 \lstinline{cm}。\\
  \textbf{重要提示}：原先通过 \lstinline{newtxmath} 宏包设置的数学字体改为 \LaTeX{} 默认数学字体，如果需要保持原来的字体，需要显式声明数学字体（\lstinline{math=newtx}）；
  \item 新增中文字体选项 \lstinline{chinesefont}，可选项为 \lstinline{ctexfont}、\lstinline{founder} 和 \lstinline{nofont}。
  \item 将封面作者信息设置为可选，并且增加自定义信息命令 \lstinline{\bioinfo}；
  \item 在说明文档中增加版本历史，新增 \lstinline{\datechange} 命令和 \lstinline{change} 环境；
  \item 增加汉化章节选项 \lstinline{scheme}，可选项为汉化 \lstinline{chinese}；
  \item 由于 \lstinline{\lvert} 问题已经修复，重新调整 \lstinline{ctex} 宏包和 \lstinline{amsmath} 宏包位置。
  \item 修改页眉设置，去除了 \lstinline{\lastpage} 以避免 page anchor 问题，加入 \lstinline{\frontmatter}。
  \item 修改参考文献选项 \lstinline{cite}，可选项为数字 \lstinline{numbers}、 作者-年份 \lstinline{authoryear} 以及上标 \lstinline{super}。
  \item 新增参考文献样式选项 \lstinline{bibstyle}，并将英文模式下参考文献样式 \lstinline{apalike} 设置为默认值，中文仍然使用 \lstinline{gbt7714} 宏包设置。
\end{change}

\datechange{2019/08/18}{版本 3.09 正式发布}

\begin{change}
  \item \lstinline{\elegantpar} 存在 bug，删除 \lstinline{\elegantpar} 命令，建议用户改用 \lstinline{\marginnote} 和 \lstinline{\marginpar} 旁注命令。
  \item 积分操作符统一更改为 \lstinline{esint} 宏包设置；
  \item 新增目录选项 \lstinline{toc}，可选项为单栏 \lstinline{onecol} 和双栏 \lstinline{twocol}；
  \item 手动增加参考文献选项 \lstinline{cite}，可选项为上标形式 \lstinline{super}；
  \item 修正章节习题（\lstinline{problemset}）环境。
\end{change}

\datechange{2019/05/28}{版本 3.08 正式发布}

\begin{change}
  \item 修复 \lstinline{\part} 命令。
  \item 引入 Note 模板中的 \lstinline{pad} 选项 \lstinline{device=pad}。
  \item 数学字体加入 \lstinline{mtpro2} 可选项 \lstinline{math=mtpro2}，使用免费的 \lstinline{lite} 子集。
  \item 将参考文献默认显示方式 \lstinline{authoyear} 改为 \lstinline{numbers}。
  \item 引入旁注命令 \lstinline{\marginpar}（测试）。
  \item 新增章节摘要环境 \lstinline{introduction}。
  \item 新增章节习题环境 \lstinline{problemset}。
  \item 将 \lstinline{\equote} 重命名为 \lstinline{\extrainfo}。
  \item 完善说明文档，增加致谢部分。
\end{change}

\datechange{2019/04/15}{版本 3.07 正式发布}

\begin{change}
  \item 删除中英文自定义字体总设置。
  \item 新增颜色主题，并将原绿色默认主题设置为蓝色 \lstinline{color=blue}。
  \item 引入隐藏装饰图案选项 \lstinline{base}，可选项有显示 \lstinline{show} 和隐藏 \lstinline{hide}。
  \item 新增定理模式 \lstinline{mode}，可选项有简单模式 \lstinline{simple} 和炫彩模式 \lstinline{fancy}。
  \item 新增隐藏证明、答案等环境的选项 \lstinline{result=noanswer}。
\end{change}

\datechange{2019/02/25}{版本 3.06 正式发布}

\begin{change}
  \item 删除水印。
  \item 新封面，新装饰图案。
  \item 添加引言使用说明。
  \item 修复双面 \lstinline{twoside}。
  \item 美化列表环境。
  \item 增加 \lstinline{\subsubsection} 的设置。
  \item 将模板拆分成中英文语言模式。
  \item 使用 \lstinline{lstlisting} 添加代码高亮。
  \item 增加定理类环境使用说明。
\end{change}

\datechange{2019/01/22}{版本 3.05 正式发布}

\begin{change}
  \item 添加 \lstinline{xeCJK} 宏包中文支持方案。
  \item 修复模板之前对 Ti\textit{k}Z 单位的改动。
  \item 更新 logo 图。
\end{change}

\datechange{2019/01/15}{版本 3.04 正式发布}

\begin{change}
  \item 格式化模板代码。
  \item 增加 \lstinline{\equote} 命令。
  \item 修改 \lstinline{\date}。
\end{change}

\datechange{2019/01/08}{版本 3.03 正式发布}

\begin{change}
  \item 修复附录章节显示问题。
  \item 小幅优化封面代码。
\end{change}

\datechange{2018/12/31}{版本 3.02 正式发布}

\begin{change}
  \item 修复名字系列命令自定义格式时出现的空格问题，比如 \lstinline{\listfigurename}。
  \item 英文定理类名字改为中文名。
  \item 英文结构名改为中文。
\end{change}

\datechange{2018/12/16}{版本 3.01 正式发布}

\begin{change}
  \item 调整 \lstinline{ctex} 宏包。
  \item 说明文档增加更新内容。
\end{change}

\datechange{2018/12/06}{版本 3.00 正式发布}

\begin{change}
  \item 删除 \lstinline{mathpazo} 数学字体选项。
  \item 添加邮箱命令 \lstinline{\mailto}。
  \item 修改英文字体为 \lstinline{newtx} 系列，另外大型操作符号维持 cm 字体。
  \item 中文字体改用 \lstinline{ctex} 宏包自动设置。
  \item 删除 \lstinline{xeCJK} 字体设置，原因是不同系统字体不方便统一。
  \item 定理换用 \lstinline{tcolorbox} 宏包定义，并基本维持原有的定理样式，优化显示效果，支持跨页；定理类名字重命名，如 etheorem 改为 theorem 等等。
  \item 删去自定义的缩进命令 \lstinline{\Eindent}。
  \item 添加参考文献宏包 \lstinline{natbib}。
  \item 颜色名字重命名。
\end{change}

\nocite{*}

\printbibliography[heading=bibintoc, title=\ebibname]
\appendix

\chapter{基本数学工具}


本附录包括了计量经济学中用到的一些基本数学，我们扼要论述了求和算子的各种性质，研究了线性和某些非线性方程的性质，并复习了比例和百分数。我们还介绍了一些在应用计量经济学中常见的特殊函数，包括二次函数和自然对数，前 4 节只要求基本的代数技巧，第 5 节则对微分学进行了简要回顾；虽然要理解本书的大部分内容，微积分并非必需，但在一些章末附录和第 3 篇某些高深专题中，我们还是用到了微积分。

\section{求和算子与描述统计量}

\textbf{求和算子} 是用以表达多个数求和运算的一个缩略符号，它在统计学和计量经济学分析中扮演着重要作用。如果 $\{x_i: i=1, 2, \ldots, n\}$ 表示 $n$ 个数的一个序列，那么我们就把这 $n$ 个数的和写为：

\begin{equation}
\sum_{i=1}^n x_i \equiv x_1 + x_2 +\cdots + x_n
\end{equation}



\end{document}
